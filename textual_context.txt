# Aixavier Edge Analytics Stack

> Railway-grade CCTV analytics, automation agents, and orchestration tooling tuned for NVIDIA Jetson Xavier (AGX / NX).

This repository contains everything needed to ingest RTSP/ONVIF feeds, execute 22 analytics workloads, surface events, and keep the stack documented through an automation agent that curates model intel and changelogs. The current layout is being refactored toward the conventions captured in `AGENTS.md`; refer to that guide when adding new modules under `src/aixavier/`.

## Quickstart
```bash
git clone https://github.com/{{ORG_NAME}}/aixavier.git
cd aixavier
cp .env.example .env                    # keep placeholders until secrets are issued
make placeholders:list                  # discover required variables
make placeholders:resolve FROM=.env     # map .env into configs/*
make bootstrap                          # create .venv, install deps, warm TensorRT engines
make demo                               # bring up docker-compose demo with synthetic RTSP feed
```

Once the demo profile is healthy, switch to production profiles by exporting `PROFILE=all` (full 22-rule workload) or pointing to a bespoke profile file via `PROFILE=path/to/profile.yaml`.

**Important:** Run `make placeholders:check` before shipping or deploying. Only commit `.env.example` and templates—never real secrets. See [`docs/placeholders.md`](docs/placeholders.md) for the live inventory.

## Daily Driver Commands
| Command                                   | Purpose                                                                                                                 |
| ----------------------------------------- | ----------------------------------------------------------------------------------------------------------------------- |
| `make bootstrap`                          | Bootstrap virtualenv, install runtime + dev tooling, pre-build engines.                                                 |
| `make run PROFILE=<name>`                 | Launch the docker compose stack for the selected profile.                                                               |
| `make demo`                               | Generate demo assets and start the curated eight-rule showcase.                                                         |
| `make perf`                               | Capture FPS, latency, and GPU utilisation snapshots from the exporter API.                                              |
| `make test`                               | Run pytest suite plus RTSP smoke tests.                                                                                 |
| `make lint`                               | Run ruff (lint) and mypy (type checks) over `src` and `tools`.                                                          |
| `make agent:refresh -- --dry-run`         | Exercise the maintainer agent without mutating docs.                                                                    |
| `make clean`                              | Tear down compose services, remove the virtualenv, and clear caches.                                                    |
| `make live CONFIG=... SRC=...`            | Run the local detector pipeline; spawns ingest + detector with your config/source (defaults to pose velocity + webcam). |
| `SHOW=1 make live ...`                    | Same as above, but opens a preview window with pose overlays.                                                           |
| `RECORD=artifacts/pose.mp4 make live ...` | Same as above, but records the annotated frames to MP4 (combine with `SHOW=1` if desired).                              |

### Model assets
- Place development ONNX exports under `models/object/onnx/` and `models/pose/onnx/` if you want CPU-backed inference.
- Promote production TensorRT engines (FP16/INT8) into `models/usecases/<use-case>/fp16|int8/` and update `configs/detectors/*.yaml` to match.
- Run `models/bootstrap_models.py` to generate placeholder files when CI needs to stub missing assets.

### Multi-person pose (top-down)
- `configs/detectors/pose_velocity.yaml` now includes a `person_detector` block (default: YOLO11n) so the pose runner crops **each person** before running RTMPose. Populate `models/object/onnx/yolo11n.onnx` (or any compatible detector), adjust the thresholds if needed, and run `SHOW=1 make live`—each person receives an independent skeleton and banner.
- Exporting YOLO11n to ONNX:
  ```bash
  source .venv/bin/activate
  pip install --upgrade ultralytics
  yolo export model=yolo11n.pt format=onnx imgsz=640 dynamic=False simplify=True
  mv yolo11n.onnx models/object/onnx/
  ```
- If you prefer bottom-up pose (single-person), remove the `person_detector` section and the runtime will fall back to whole-frame inference.

### Tracker configuration
- ByteTrack-lite is enabled by default (`TRACKER_ALGO=bytetrack`). Override with `TRACKER_ALGO=simple` if you need the lightweight IoU tracker for debugging.
- Pose trackers use `POSE_TRACKER_ALGO` (defaults to `simple`); set to `bytetrack` once you need tighter pose ID smoothing.
- Additional knobs: `TRACKER_HIGH_THRESH`, `TRACKER_LOW_THRESH`, `TRACKER_MATCH_IOU`, `TRACKER_MAX_AGE` (and matching `POSE_TRACKER_*` variables).

### Webcam smoke test
For a one-shot local run that wires up ingest + detectors automatically:
```bash
make live SRC=webcam:0 CONFIG=configs/detectors/pose_velocity.yaml
```
Behind the scenes this command spawns `src.ingest_gst.main` with your chosen source (webcam, RTSP, file, or synthetic) and feeds frames to `src.runners.main`. Artifacts land under `artifacts/live_demo/` so you can inspect captured frames and emitted events. Override `OUTPUT`, `CAMERA`, or `FPS` when you need custom layouts.

If you prefer using the docker-compose stack, you can still export `CAMERA_RTSP_URL_01=webcam://0` and run `make run PROFILE=demo` to test the full pipeline.

Want a quick visual? Add `--show` (or `SHOW=1 make live ...`) to open an OpenCV window with skeleton overlays, or `--record artifacts/pose_demo.mp4` (or `RECORD=... make live ...`) to capture an annotated MP4 for sharing.

To drive ingest manually (e.g., when you only want to capture frames/logs), use the new CLI flags:
```bash
python -m src.ingest_gst.main \
  --source webcam:0 \
  --output artifacts/ingest \
  --log-path artifacts/ingest/frames.log \
  --camera-id CAM_WEB
```
By default frames are ephemeral—the detector deletes them right after reading so your disk doesn’t fill up. Pass `--save-frames` if you genuinely need every JPEG persisted for later inspection. `--source` accepts `webcam:<index>`, `demo://synthetic`, RTSP URLs, or file paths; omit it to read from `configs/cameras.yaml` as before.

Want persistent captures during `make live`? Just run `SAVE_FRAMES=1 make live ...`.

### Generating detector engines
1. Export ONNX (if you haven’t already) and place it under `models/usecases/<use-case>/onnx/`.
2. Convert to TensorRT FP16 on Jetson/x86 with TensorRT installed:
   ```bash
   trtexec \
     --onnx=models/usecases/pose/rtmpose_onnx/.../end2end.onnx \
     --saveEngine=models/usecases/pose/fp16/rtmpose.engine \
     --fp16 --workspace=4096
   trtexec \
     --onnx=models/usecases/object_detection/onnx/yolov11n.onnx \
     --saveEngine=models/usecases/object_detection/fp16/yolov11n.engine \
     --fp16 --workspace=4096
   ```
3. Update `configs/detectors/object.yaml` / `configs/detectors/pose_velocity.yaml` if your filenames differ. Leave INT8 calibration for later (the scripts under `models/*/calibrate.sh` act as placeholders until we capture calibration sets).

## Runtime Profiles at a Glance
| Profile   | Focus                          | FPS Target | Notable Intervals                                          |
| --------- | ------------------------------ | ---------- | ---------------------------------------------------------- |
| `minimal` | Tamper + Trespass              | 30         | Detectors on every frame.                                  |
| `demo`    | Eight representative use cases | 25         | Action detectors every 3 frames, face recognition every 2. |
| `all`     | Full 22-rule workload          | 25         | Per-use-case intervals in `configs/usecases/*.yaml`.       |

Select a profile by exporting `PROFILE=<name>` or passing `PROFILE=...` to individual make targets. Compose profiles live under `docker-compose.yml`.

## System Overview
1. **Ingest (`src/ingest_gst/`)** – DeepStream-based RTSP/ONVIF ingestion with automatic reconnects, watermarks, and NVMM zero-copy paths.
2. **Runners (`src/runners/`)** – TensorRT engines (FP16 baseline, INT8 optional) grouped by modality: object, face, pose, action, smoke, and violence. The shared detector runtime (`src/runners/detectors.py`) can fall back to ONNX/CPU inference when engines are absent, so you can validate pipelines before dropping production engines into `models/usecases/`.
3. **Trackers (`src/trackers/`)** – ByteTrack-lite with optional fallback to `SimpleTracker`; pose IDs are associated to the latest person tracks. Wire in OSNet ReID for production deployments.
4. **Rules (`src/rules/`)** – YAML-driven behavioural engine handling ROIs, dwell times, line crossings, and domain-specific semantics.
5. **Privacy (`src/privacy/`)** – SCRFD + ArcFace inference, encrypted embeddings, RBAC checks, and audit logging.
6. **Events (`src/events/`)** – Normalises detections, ships MQTT/REST payloads, and persists artefacts.
7. **Recorder (`src/recorder/`)** – Circular buffers with pre/post recording windows, watermarking, hashing, and export flows.
8. **Exporter (`src/exporter/`)** – Prometheus metrics and OpenTelemetry traces surfaced via HTTP.
9. **UI (`src/aixavier/ui/`)** – FastAPI backend exposes endpoints for ROI editing, event browser, and toggles. See `src/aixavier/ui/README.md` for API details. Frontend integration is planned.
10. **Automation Agent (`src/agent/`)** – Gathers model intelligence, updates documentation, and logs activity to `HANDOFF.md`.

The refactor toward `src/aixavier/` will co-locate agents under `src/aixavier/agents/` and shared infrastructure under `src/aixavier/core/`. Existing modules will migrate in-place; prefer those paths for new code.

## Repository Layout
- `AGENTS.md` – Contribution, testing, and naming conventions (read before opening PRs).
- `configs/` – Profiles, rulepacks, camera definitions, and placeholder-friendly YAML.
- `deploy/` – Flash scripts, systemd units, Grafana dashboards, and logrotate configs.
- `docs/` – Operational runbooks (`SETUP.md`, `PERFORMANCE.md`, `PRIVACY.md`, `TROUBLESHOOT.md`, etc).
- `docs/IMPLEMENTATION_STATUS.md` – Snapshot of current service/model progress for quick onboarding.
- `models/` – TensorRT engine builders and calibration scripts.
- `models/usecases/` – drop-in folder for the 22 production-ready detection/pose engines (place FP16/INT8 artifacts here when promoting models).
- `src/` – Runtime services and automation agent (pending relocation to `src/aixavier/`).
- `tests/` – Pytest suites, fixtures, and RTSP connectivity scripts.
- `tools/` – Placeholder resolvers, lint helpers, and release automation.
- `HANDOFF.md` – Append-only log shared with the automation agent.
- `.env.example` – Placeholder inventory; keep secrets out of Git.

## Documentation & Observability
- Metrics surface at `http://{{PROMETHEUS_SCRAPE_PORT}}/metrics`; Grafana dashboard JSON lives in `deploy/grafana/edge-cctv.json`.
- Refer to `docs/TROUBLESHOOT.md` for RTSP/ONVIF, codec, and thermal triage.
- `docs/PERFORMANCE.md` outlines DeepStream batching, detector intervals, and `nvpmodel` presets.
- `docs/placeholders.md` serves as the live index for required secrets and config keys.

## Automation Agent Workflow
The maintainer bot runs via `make agent:refresh` or the scheduled workflow under `.github/workflows/agent-refresh.yml`. It:
- Scans for new vision models and datasets (`src/agent/webscan`).
- Ranks candidates based on deployment constraints (`src/agent/rank`).
- Updates documentation blocks and logs actions to `HANDOFF.md`.

Gate the agent with a dry run before allowing it to write:
```bash
make agent:refresh -- --dry-run
```
When satisfied, drop the `--dry-run` flag to persist updates.

## Security & Placeholder Hygiene
- Never substitute real credentials directly in committed files—leave `{{PLACEHOLDER}}` tokens intact.
- Use `make placeholders:check` to ensure all placeholders resolve before shipping production builds.
- Secrets live in `.env` (gitignored) and environment-specific secret stores.
- See [`docs/placeholders.md`](docs/placeholders.md) for the live inventory and resolution status.

## Governance & Next Steps
- Follow Conventional Commits and keep subject lines ≤72 characters.
- CI (see `.github/workflows/agent-ci.yml`) runs lint, tests, placeholder checks, and secret scanning.
- Record any roadmap items in [`docs/next_steps.md`](docs/next_steps.md) and [`docs/IMPLEMENTATION_STATUS.md`](docs/IMPLEMENTATION_STATUS.md) rather than inline TODO comments.
- The next structural milestone is migrating runtime modules under `src/aixavier/` per [`AGENTS.md`](AGENTS.md).

## Live Auto Sections
<!-- auto:start name=recommended-models -->
| Rank | Task                 | Model                 | FP16 (ms) | INT8 (ms) | Accuracy | License    | Last Checked |
| ---- | -------------------- | --------------------- | --------- | --------- | -------- | ---------- | ------------ |
| 1    | face_recognition     | MobileFaceNet ArcFace | 2.10      | 1.50      | 0.996    | MIT        | 2025-09-27   |
| 2    | reid                 | OSNet_x0_25           | 1.90      | 1.30      | 0.508    | MIT        | 2025-09-22   |
| 3    | face_detection       | SCRFD-500M            | 6.20      | 4.10      | 0.915    | MIT        | 2025-09-27   |
| 4    | fire_smoke_detection | EfficientNet-B0 Fire  | 9.80      | 6.70      | 0.923    | Apache-2.0 | 2025-09-18   |
| 5    | violence_detection   | MobileNet-TSM         | 12.90     | 9.00      | 0.842    | Apache-2.0 | 2025-09-21   |
| 6    | pose_estimation      | yolov11n-pose         | 11.30     | 7.90      | 0.608    | GPLv3      | 2025-09-30   |
<!-- auto:end -->

<!-- auto:start name=performance-tuning -->
- **DeepStream primary-gie batching**: Use batch-size=2 for yolov11n on AGX when PROFILE=all; falls back to 1 on NX. (_Impact_: Improves ingest FPS by ~8% while keeping latency under 40 ms.)
- **TensorRT DLA offload**: Assign SCRFD embedding head to DLA0 in demo profile to free SMs for violence detector. (_Impact_: Reduces GPU util by 6% during peak loads.)
- **Recorder I/O buffering**: Set GStreamer queue `max-size-time=3000000000` (3 s) for circular buffer stability. (_Impact_: Prevents underflow when writing to slower eMMC storage.)
<!-- auto:end -->

<!-- auto:start name=known-issues -->
- **[MEDIUM] INT8 export fails for YOLOv10n on TensorRT 8.6.1** — The TensorRT ONNX parser in JetPack 5.1.2 lacks support for new YOLOv10 detection head ops. _Impact_: INT8 acceleration unavailable for YOLOv10n until JetPack 6 or custom plugin compiled. _Workaround_: Stick to FP16 or backport the opset-18 plugin from TensorRT OSS. [Details](https://github.com/THU-MIG/yolov10/issues/42)
- **[LOW] SCRFD false positives in dense steam scenarios** — Steam near coach doors triggered high-confidence face detections. _Impact_: FRS blur triggers and audit noise during cleaning cycles. _Workaround_: Enable ROI mask for door corners and tighten `FRS_THRESHOLD` to 0.52 when cleaning profile active. [Details](https://insightface.ai/docs/scrfd/troubleshooting)
- **[HIGH] X3D-S memory spike on Jetson Xavier NX 8GB** — Batch=2 clip inference spikes VRAM over 7.2GB causing OOM with UI co-located. _Impact_: Violence detector crashes on NX unless intervals increased. _Workaround_: Set `ACTION_CLIP_BATCH=1` and raise clip stride to 3. [Details](https://forums.developer.nvidia.com/t/x3d-s-oom/298741)
<!-- auto:end -->

<!-- auto:start name=changelog -->
- 2025-10-07: Catalog refresh (models=10, datasets=44, placeholders=40).
- 2025-10-07: Catalog refresh (models=10, datasets=44, placeholders=42).
- 2025-10-07: Initial repository scaffold for Jetson Xavier railway CCTV analytics.
- 2025-10-07: Updated README to document bootstrap commands, module layout, and upcoming `src/aixavier/` migration.
<!-- auto:end -->
- Detector post-processing unit tests rely on NumPy; set `AIXAVIER_ENABLE_NUMPY_TESTS=1` when that runtime is available.
# Repository Guidelines

This repository is being scaffolded for a collection of automation agents and supporting orchestration utilities. Follow the practices below so that early contributions converge toward a consistent, maintainable layout.

## Project Structure & Module Organization
- Keep runtime code in `src/aixavier/`, grouping agents under `src/aixavier/agents/` and shared abstractions under `src/aixavier/core/`.
- Detector runtimes temporarily live under `src/runners/` (`detectors.py` hosts the shared inference loop); plan to relocate to `src/aixavier/vision/` during the refactor.
- Place evaluation data, prompt templates, and fixtures in `assets/` with subfolders such as `assets/prompts/` and `assets/datasets/`.
- Store documentation artifacts in `docs/` and diagrams in `docs/diagrams/`.
- Co-locate smoke scripts or notebooks in `experiments/` but promote anything reusable into `src/`.
- House all automated tests in `tests/`, mirroring the `src/` package layout (e.g., `tests/agents/test_memory.py` exercises `src/aixavier/agents/memory.py`).

## Build, Test, and Development Commands
```bash
python -m venv .venv && source .venv/bin/activate      # bootstrap local environment
pip install -r requirements.txt                        # install core runtime deps
pip install -r requirements-dev.txt                    # install lint/test tooling
pytest                                                  # run the full unit and integration suite
ruff check src tests                                    # lint and static analysis
python -m build                                         # produce a distributable wheel/sdist
```

## Coding Style & Naming Conventions
- Use 4-space indentation, type hints, and Python 3.11+ features where they clarify intent.
- Run `black` (line length 100) and `ruff` before opening a pull request; configure editors to respect `.editorconfig`.
- Modules follow snake_case (`memory_router.py`), classes use PascalCase (`MemoryRouter`), and functions/variables use snake_case (`route_message`).
- Environment variables should be upper-case with underscores (`AGENT_TIMEOUT_SECONDS`) and defined in `.env.example`.
- When wiring detectors, ensure ONNX exports are staged under `models/<modality>/onnx/` for CPU validation and TensorRT engines under `models/usecases/<use-case>/` before enabling CI.
- Tracker utilities live in `src/trackers/bytetrack.py`; extend `SimpleTracker` or swap to full ByteTrack/ReID before productionization.

## Testing Guidelines
- Prefer `pytest` test modules named `test_<subject>.py`; within each module, describe behaviors (`def test_memory_router_retries_on_timeout():`).
- Add integration tests under `tests/integration/` when exercising external services or orchestrations.
- Target ≥90% coverage on critical agent pathways; update `tests/README.md` with edge cases when introducing new tooling.
- Use `pytest -k "<keyword>"` locally for focused runs and ensure CI passes before requesting review.
- Detector post-process tests require NumPy; export `AIXAVIER_ENABLE_NUMPY_TESTS=1` when the runtime is available.

## Commit & Pull Request Guidelines
- Adopt Conventional Commits from the outset (`feat: add planner agent skeleton`, `fix: tighten retry budget`); keep subject lines ≤72 characters.
- Squash work-in-progress commits locally; each PR should read as a cohesive story with linked issues or roadmap items.
- Pull requests must include: scope summary, testing notes (commands + results), screenshots or logs for UI/UX changes, and follow-up tasks if applicable.
- Tag reviewers responsible for the touched subsystem (`@agents`, `@infra`) and add TODOs to `docs/roadmap.md` instead of burying them in code comments.

## Security & Configuration Tips
- Never commit API keys or secrets; rely on `.env` (gitignored) and document required keys in `.env.example`.
- Rotate credentials quarterly and reference secret names (not values) in documentation.
- When integrating third-party tools, sandbox them under dedicated service accounts and capture onboarding steps in `docs/integrations/`.
# Implementation Status – 2025-10-31

This document summarises the current state of the Aixavier Edge Analytics stack so a new engineer (human or assistant) can resume work without digging through code history.

**Status:** Demo-ready for 8 workloads; production requires real models, secrets, and CI hygiene. See [`docs/next_steps.md`](docs/next_steps.md) for prioritized roadmap and [`docs/placeholders.md`](docs/placeholders.md) for live placeholder status. For onboarding, see the [README](../README.md).

## Services Overview

| Service                     | Code Path                                                       | Status           | Notes                                                                                                                          |
| --------------------------- | --------------------------------------------------------------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| ingest                      | `src/ingest_gst/`                                               | Demo-ready       | Synthetic + RTSP + `webcam://` capture (needs on-device validation).                                                           |
| detect_object               | `src/runners/` (config: `configs/detectors/object.yaml`)        | ONNX/TRT-capable | Uses shared runner with ONNX fallback and SimpleTracker IDs; requires production engines.                                      |
| detect_pose                 | `src/runners/` (config: `configs/detectors/pose_velocity.yaml`) | ONNX/TRT-capable | Pose events aligned with object tracks via cached detections; needs real models.                                               |
| detect_face / detect_action | `src/runners/`                                                  | Simulated        | Still emit synthetic events; promote to real inference later.                                                                  |
| tracker                     | `src/trackers/`                                                 | ByteTrack-lite   | ByteTrack-style matcher with Simple fallback; ReID still pending.                                                              |
| rules                       | `src/rules/engine.py`                                           | Demo-ready       | Dwell logic fixed; other rule types awaiting real data.                                                                        |
| recorder                    | `src/recorder/`                                                 | Stub             | Writes JSON; replace with video circular buffer.                                                                               |
| privacy                     | `src/privacy/`                                                  | Stub             | Enrollment + embeddings need hardened store/RBAC.                                                                              |
| exporter                    | `src/exporter/`                                                 | Stub             | Emits simulated metrics; wire to real telemetry.                                                                               |
| ui                          | `src/ui/`                                                       | Basic            | FastAPI endpoints + Streamlit; requires full dashboard build-out.                                                              |
| ui                          | `src/aixavier/ui/`                                              | Basic            | FastAPI endpoints for ROI editor, event browser, and toggles. See module README for API details. Frontend integration planned. |

## Use Case Catalog (22 total)

Use-case metadata is tracked centrally in `assets/usecases/catalog.yaml` (auto-parsed from `All Data Analytics use cases for CCTV under POC.xlsx`) and wired into `src/aixavier/core/usecases.py`. The registry surfaces every workload, their applicability, and now feeds the rule engine + docs in a single place.

### Stage Tracker

| #   | Use Case                                                                                                                   | Stage      | Notes                                                                                                   |
| --- | -------------------------------------------------------------------------------------------------------------------------- | ---------- | ------------------------------------------------------------------------------------------------------- |
| 1   | Trespassing on Railway Track                                                                                               | demo-ready | Uses object detector + ByteTrack in demo profile.                                                       |
| 2   | Stone pelting                                                                                                              | simulated  | Needs action detector + projectile heuristics; current runner emits synthetic action events.            |
| 3   | Camera tampering                                                                                                           | demo-ready | Blur/scene-change rules active via tamper detector.                                                     |
| 4   | People Counting & Occupancy in Locomotives                                                                                 | demo-ready | Object detector + tracker cover threshold counts; needs calibration for real density.                   |
| 5   | Smoke/Fire detection &  Haze / reduction in visibility detection                                                           | demo-ready | Object detector with placeholder smoke config; requires real fire/haze models.                          |
| 6   | Object Identification and classify                                                                                         | planned    | Requires banned-object classifier + rulepack tuning.                                                    |
| 7   | Securing of Coach Doors and the electrical panels in the doorway area.                                                     | planned    | Needs door state/geo-fencing inputs; no telemetry ingestion yet.                                        |
| 8   | Medical emergency detection in Circulation Area                                                                            | demo-ready | Pose detector + velocity drop heuristics wired in demo profile.                                         |
| 9   | Railway Staff Movement (Security Patrol and maintenance staff including coach attendants) Detection during train operation | planned    | Depends on ReID embeddings + tracker persistence (OSNet not wired).                                     |
| 10  | On demand viewing of cameras                                                                                               | planned    | UI/exporter need live switching & secure proxy; only basic API exists.                                  |
| 11  | Unattended baggage detection in circulation area                                                                           | demo-ready | Object dwell rule active; tune timers for real scenes.                                                  |
| 12  | Human aggression or violence detection                                                                                     | simulated  | Action detector simulated; X3D/MobileNet engines not integrated.                                        |
| 13  | Passenger falling from door in moving train                                                                                | planned    | Needs pose + action fusion with GPS speed gate; not wired.                                              |
| 14  | Face Recognition                                                                                                           | partial    | SCRFD/ArcFace pipeline stubbed; privacy service stores encrypted embeddings but matching logic limited. |
| 15  | Cleaning & hygiene monitoring in Circulation Area                                                                          | planned    | Requires change-detection model + ROI config; not implemented.                                          |
| 16  | Child safety monitoring                                                                                                    | planned    | Needs child-specific tracker/dwell logic + guardian detection.                                          |
| 17  | Vandalism detection                                                                                                        | planned    | Needs change/action detectors + ROI masks; not implemented.                                             |
| 18  | Validation of Panic alarm                                                                                                  | planned    | Requires telemetry ingestion + camera correlation; not implemented.                                     |
| 19  | Calling (voice) out signal aspect                                                                                          | planned    | Audio ingestion + ASR classifier missing.                                                               |
| 20  | Hand gesture (for identification of signal)                                                                                | simulated  | Pose runner exists but gesture classifier not trained; rulepack placeholder.                            |
| 21  | Emergency Brake Valve (RS value) operation during SPAD                                                                     | planned    | Needs telemetry + object recognition on cab cameras; not implemented.                                   |
| 22  | Mobile Phone Usage detection                                                                                               | simulated  | Pose/gesture logic missing; action runner simulated.                                                    |

**Snapshot:** 8/22 use cases produce demo events today, 5 rely on simulated detectors, and 9 remain in planning/backlog. Use `UseCaseRegistry().summary()` to pull this table programmatically during CI/tests.

### Applicability / Detector View

| #   | Use Case                                                               | Applicability   | Deployment               | Maturity   | Detectors           |
| --- | ---------------------------------------------------------------------- | --------------- | ------------------------ | ---------- | ------------------- |
| 1   | Trespassing on Railway Track                                           | Loco            | Post Incident Need Based | demo-ready | object, tracker     |
| 2   | Stone pelting                                                          | Loco            | Post Incident Need Based | planned    | object, action      |
| 3   | Camera tampering                                                       | All             | Real Time.               | demo-ready | integrity           |
| 4   | People Counting & Occupancy in Locomotives                             | All             | Real Time.               | demo-ready | object, tracker     |
| 5   | Smoke/Fire detection &  Haze / reduction in visibility detection       | All             | Real Time.               | demo-ready | environment, object |
| 6   | Object Identification and classify                                     | Coach and Locos | Real time.               | planned    | object              |
| 7   | Securing of Coach Doors and the electrical panels in the doorway area. | Coach           | Real time.               | planned    | object, telemetry   |
| 8   | Medical emergency detection in Circulation Area                        | Coach           | Real time.               | demo-ready | pose                |
| 9   | Railway Staff Movement ...                                             | Coach           | Real time.               | planned    | reid, tracker       |
| 10  | On demand viewing of cameras                                           | All             | Both                     | planned    | observability       |
| 11  | Unattended baggage detection in circulation area                       | Coach           | Both                     | demo-ready | object, dwell       |
| 12  | Human aggression or violence detection                                 | All             | Both                     | planned    | action              |
| 13  | Passenger falling from door in moving train                            | All             | Real time.               | planned    | pose, action        |
| 14  | Face Recognition                                                       | All             | Both                     | partial    | frs                 |
| 15  | Cleaning & hygiene monitoring in Circulation Area                      | Coach           | Both                     | planned    | object, change      |
| 16  | Child safety monitoring                                                | Coach           | Both                     | planned    | tracker, dwell      |
| 17  | Vandalism detection                                                    | Coach and Locos | Both                     | planned    | object, action      |
| 18  | Validation of Panic alarm                                              | Coach           | Real time.               | planned    | telemetry, object   |
| 19  | Calling (voice) out signal aspect                                      | Loco            | Both                     | planned    | audio               |
| 20  | Hand gesture (for identification of signal)                            | Loco            | Both                     | planned    | pose, action        |
| 21  | Emergency Brake Value ... SPAD                                         | Loco            | Both                     | planned    | object, telemetry   |
| 22  | Mobile Phone Usage detection                                           | Loco            | Both                     | planned    | pose, action        |

## Models & Assets

- Place ONNX exports under modality folders (`models/object/onnx`, `models/pose/onnx/rtmpose_onnx`, `models/action/onnx`, etc.); promote TensorRT engines into `models/usecases/<use-case>/fp16|int8/` only when they are production-ready.
- Stage production TensorRT engines under `models/usecases/<use-case>/fp16/` (INT8 later).
- `models/pose/TODO.md` and `models/object/TODO.md` track outstanding work for the two active use cases.
- Calibration datasets should live under `models/<modality>/calib/`.
- `configs/detectors/pose_velocity.yaml` now embeds a `person_detector` block (yolov11n by default) so RTMPose runs in a top-down, multi-person configuration—each detected person is cropped before pose inference.

### Model Group Strategy

Group shared models by analytic modality, keep raw ONNX/checkpoints beneath `models/<group>/`, and reserve `models/usecases/<slug>/` for deployable engines + INFO.md metadata. Recommended groups (covering both existing + future workloads):

| Group                       | Folder                                               | Use cases served            | Notes                                                                                                                                                           |
| --------------------------- | ---------------------------------------------------- | --------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Object detection / tracking | `models/object/...` (ONNX) + shared tracker configs  | 1,4,5,6,7,11,15,16,17,18,21 | Backed by yolov11/YOLOv10 exports; tracker tuned via `configs/tracker.yaml`.                                                                                    |
| Pose & velocity             | `models/pose/onnx/rtmpose_onnx/...`                  | 8,13,20,22                  | RTMPose ONNX feeds TRT engines under `models/usecases/pose/`; multi-person crops come from the shared YOLO person detector (`models/object/onnx/yolo11n.onnx`). |
| Action / clip analytics     | `models/action/onnx/...`                             | 2,12,13,17,20,22            | Hosts X3D-S, MobileNet-TSM, gesture classifiers. Current services still simulated—wire TRT engines + calibration here.                                          |
| Face / ReID                 | `models/face/...`, `models/reid/...`                 | 9,14                        | SCRFD + ArcFace + OSNet_x0_25 assets live here; upgrade once production engines ready.                                                                          |
| Audio / ASR                 | `models/audio/...`                                   | 19                          | Placeholder for future speech-recognition weights used in calling-out-signal-aspect detection.                                                                  |
| Telemetry fusion helpers    | `models/telemetry/...` (placeholder configs/scripts) | 7,18,21                     | Holds ML models or rule scripts that combine vision with door/RS telemetry; currently empty but documented for future work.                                     |

Nothing needs to be deleted: keep the modality folders (`models/object`, `models/pose`, `models/action`, `models/face`, `models/reid`, etc.) and gradually migrate ONNX exports into them. Only place fully vetted TensorRT engines (and their checksums/INFO.md) into `models/usecases/<slug>/`. This keeps the repo lightweight while still exposing a predictable locker for deployment artifacts.

## Tracking & Pose Association

- `SimpleTracker` assigns persistent IDs per camera and caches the latest object detections under `artifacts/detections/cache/<camera>.json`.
- Pose detections reuse cached `person` boxes for track association; accuracy will improve once ByteTrack + ReID is added.

## Tests & CI Gating

- `pytest` suite covers rule engine, tracker, and (optionally) detector post-processing. Set `AIXAVIER_ENABLE_NUMPY_TESTS=1` when NumPy is available to enable ONNX layout tests.
- Add integration tests once real models are staged.
- **Placeholder hygiene is enforced in CI:**
	- The placeholder linter (`tools/placeholder_lint.py`) and smoke test (`tests/test_placeholders_smoke.py`) ensure all secrets and placeholders are either resolved or documented in [`docs/placeholders.md`](docs/placeholders.md).
	- The linter ignores `.venv/`, `site-packages`, and other non-project paths for reliability.
	- CI will fail if unresolved placeholders or undocumented secrets are found.

## Outstanding Work (High Level)

1. Replace simulated face/action detectors with real inference pipelines.
2. Integrate ByteTrack + OSNet ReID for production-grade tracking.
3. Deploy recorder (video), exporter (metrics), privacy (embeddings) with real functionality.
4. Resolve all placeholders via `.env` and the placeholder resolver before production builds.
5. Harden docs/CI: run detector integration tests and enforce placeholder gate in `agent-ci` workflow.
6. INT8 calibration for detectors (object + pose) once datasets are ready.

Refer to `docs/next_steps.md` for the detailed roadmap and `HANDOFF.md` for chronological change logs.
# Datasets

Each use case lists domain-specific and scale/quality datasets. Agent keeps this file current.

<!-- auto:start name=datasets -->
| Use Case | Bucket | Dataset | License | Size | Modality | Indoor/Outdoor | Pros | Cons | Fit | Bias Notes |
|----------|--------|---------|---------|------|---------|----------------|------|------|-----|------------|
| trespassing_on_track | domain | [RailSem19 Intrusion Split](https://railsem19.vision.rwth-aachen.de) | CC BY-NC 4.0 | 10k frames | RGB video | Outdoor | Contains rail-specific ROIs, multiple weather conditions. | Limited night coverage; Europe-centric signage. | Primary training for trespass ROI tuning. | Under-represents rural stations. |
| trespassing_on_track | scale | [COCO 2017 People Subset](https://cocodataset.org) | CC BY 4.0 | 118k images | RGB stills | Mixed | Large person detection variety. | No rail context; requires ROI filtering. | Pre-train detector for person class robustness. | Urban bias; limited PPE. |
| stone_pelting | domain | [Indian Railways Security Incidents](https://data.gov.in) | Custom (request required) | 3k clips | RGB video | Outdoor | Real-world stone pelting scenarios with annotations. | Restricted license; imbalanced classes. | Fine-tune projectile classifier. | Region-specific; cross-border generalisation unknown. |
| stone_pelting | scale | [Stanford Drone Dataset](http://cvgl.stanford.edu/projects/uav_data) | Academic only | 8h video | RGB video | Outdoor | Contains aerial moving object trajectories for speed estimation. | High vantage angle; requires domain adaptation. | Train projectile motion regression. | Campus environment, few night scenes. |
| camera_tampering | domain | [RailSafe Tamper Clips](https://rail-safety.example.com/tamper) | CC BY-NC-SA 4.0 | 2k clips | RGB video | Indoor/Outdoor | Includes blur, occlusion, defocus specific to rolling stock. | Synthetic augmentations dominate dataset. | Train tamper heuristics thresholds. | Blur severity quantised; manual review needed. |
| camera_tampering | scale | [CDNet 2014 Baseline](http://changedetection.net) | Research only | 53 sequences | RGB video | Mixed | Standard for sudden scene change, static camera. | Lower resolution than 1080p streams. | Benchmark histogram/blur metrics. | Artifacts from older codecs. |
| people_counting_occupancy | domain | [iLIDS AVSS Station](https://www.avss-pets.org) | Evaluation only | 114 clips | RGB video | Indoor | Ticket hall densities similar to coaches. | Low resolution; occlusions heavy. | Validate count accuracy and flow directions. | Mostly UK commuters. |
| people_counting_occupancy | scale | [Crowd Counting UCF-QNRF](https://www.crcv.ucf.edu/data/ucf-qnrf/) | Research only | 1,535 images | RGB stills | Outdoor | Extreme-density ground truth for model pretraining. | Outdoor scenes; perspective mismatch. | Improve density map generalisation. | Global coverage but limited rail context. |
| smoke_fire_haze | domain | [FIReS Railway Subset](https://figshare.com/articles/dataset/FIReS/) | CC BY 4.0 | 12k frames | RGB video | Indoor | Annotated coach fires and electrical smoke. | Few haze-only labels. | Train fire/smoke detector used in pipeline. | Synthetic smoke augmentation high. |
| smoke_fire_haze | scale | [OpenFire Dataset](https://github.com/ashishsinhaST/OpenFire) | MIT | 3,000 images | RGB stills | Mixed | Diverse fire sources for transfer learning. | Lacks haze labels. | Augment detection pipeline for general flames. | Mostly industrial scenes. |
| object_identification_classification | domain | [Rail PPE Dataset](https://zenodo.org/record/rail-ppe) | CC BY 4.0 | 5k images | RGB stills | Indoor | Annotated hard hats, vests, tools in coaches. | Small sample size. | Fine-tune PPE detection rules. | Limited vendor variety. |
| object_identification_classification | scale | [Open Images V7 Safety Gear](https://storage.googleapis.com/openimages/web/index.html) | CC BY 4.0 | 9M images (filtered) | RGB stills | Mixed | Massive coverage for transfer learning PPE classes. | Requires heavy filtering for quality. | Pre-train detection head for PPE categories. | Western-centric industry scenes. |
| coach_door_panel_security | domain | [RailCoach Access Control](https://rail-datahub.example.com/door-security) | Restricted | 1.2k clips | RGB video | Indoor | Annotated panel tampering events. | Requires NDA; small sample. | Validate ROI-based intrusion rules. | Mostly night scenarios. |
| coach_door_panel_security | scale | [AVA Person-Interaction Subset](https://research.google.com/ava/) | CC BY 4.0 | 430 clips | RGB video | Mixed | Rich action annotations for panel interaction proxies. | Movie scenes; domain gap exists. | Train action recognition fallback. | Cinematic bias. |
| medical_emergency_collapse | domain | [UR Fall Detection (Coach Augmented)](https://sites.google.com/site/urfall2014/) | CC BY 4.0 | 70 sequences | RGB video | Indoor | Annotated falls with occlusion variations. | Low image resolution. | Validate pose velocity heuristics. | Elder subjects; limited diversity. |
| medical_emergency_collapse | scale | [NTU RGB+D 120](https://rose1.ntu.edu.sg/dataset/actionrecognition.asp) | Research only | 114k clips | RGB+D video | Indoor | Large action coverage including falls. | Depth modality unavailable on Xavier; use RGB only. | Pre-train pose-based classifier. | Laboratory capture. |
| staff_movement_tracking | domain | [Rail Staff ReID](https://rail-reid.example.com) | Restricted | 5k tracklets | RGB video | Indoor | Uniformed staff with occlusions. | Confidential; limited share. | Fine-tune OSNet embeddings. | Single operator uniforms. |
| staff_movement_tracking | scale | [MSMT17](https://www.pkuml.org/resources/msmt17.html) | Research only | 126k images | RGB stills | Mixed | High camera diversity; day/night. | Requires resizing to 256x128. | Generic ReID pretraining. | Urban surveillance bias. |
| on_demand_viewing | domain | [Operations Replay Dataset](https://rail-ops.example.com/on-demand) | Internal | 400 clips | RGB video | Mixed | Tagged operator-triggered events for scrubber testing. | Manual labeling in progress. | QA for replay UX and metadata pipeline. | Focus on metro lines. |
| on_demand_viewing | scale | [ActivityNet Captions](http://activity-net.org/challenges/2020/tasks/anet_captioning.html) | Apache-2.0 | 20k clips | RGB video | Mixed | Enables caption search prototyping. | Narrative bias; differs from CCTV. | Benchmark retrieval UX. | Consumer videos. |
| unattended_baggage | domain | [AVSS 2007 i-LIDS Bag](https://www.avss-pets.org) | Evaluation only | 44 sequences | RGB video | Indoor | Classic benchmark with static object dwell labels. | 640p resolution. | Tune dwell thresholds and owner tracking. | Airport-like environment. |
| unattended_baggage | scale | [SVD (Surveillance Video Dataset)](https://www.svddataset.org) | CC BY-SA 4.0 | 1,500 clips | RGB video | Mixed | Multiple bag abandonment scenes. | Varied frame rates; needs normalization. | Augment static-object classifier. | Mostly public spaces. |
| human_aggression_violence | domain | [RWF-2000 Rail Augmentation](https://github.com/papercode-on-violence/rwf-2000) | CC BY-NC 4.0 | 4k clips | RGB video | Indoor | Violence clips from carriages. | Manual augmentation required. | Fine-tune action classifier. | Limited camera angles. |
| human_aggression_violence | scale | [Hockey Fight Dataset](https://www.kaggle.com/datasets/) | CC BY 4.0 | 1,000 clips | RGB video | Indoor | Clean binary violence labels. | Sports domain; high motion. | Pre-training for aggression detection. | Male-dominated dataset. |
| passenger_falling_from_door | domain | [Rail Door Safety Set](https://rail-safety.example.com/door-fall) | Restricted | 900 clips | RGB video | Outdoor | Annotated falling events near doors. | Low sample size; privacy constraints. | Validate line-crossing + pose heuristics. | Mix of metro and long-haul. |
| passenger_falling_from_door | scale | [FDDR (Fall Detection Dataset Repository)](https://github.com/ykotseruba/awesome-fall-detection) | Various | Multiple datasets (~50h) | RGB video | Mixed | Aggregated fall datasets for data augmentation. | Requires curation per license. | Backbone pretraining for fall detection. | Medical/elderly focus. |
| face_recognition | domain | [RailCrew Faces](https://secure.railfaces.example.com) | Internal | 2k identities | RGB stills | Indoor | Aligned faces with RBAC metadata. | Highly sensitive; strict auditing. | Populate on-device gallery. | Needs demographic balancing. |
| face_recognition | scale | [MS1M-RetinaFace](https://github.com/deepinsight/insightface/wiki/Dataset-Zoo) | Research only | 5.8M images | RGB stills | Mixed | Large-scale for backbone training. | Requires cleaning for duplicates. | Pre-train embeddings before fine-tune. | Global dataset; some noise. |
| cleaning_hygiene_monitoring | domain | [Coach Hygiene Logs](https://rail-cleaning.example.com) | Internal | 600 clips | RGB video | Indoor | Annotated cleaning sequences with PPE tags. | Limited lighting variations. | Rule engine validation for task sequence. | Single operator style. |
| cleaning_hygiene_monitoring | scale | [YouTube Chores Dataset](https://research.google/tools/datasets/youcook2/) | CC BY 4.0 | 15k clips | RGB video | Indoor | Sequential action annotations for temporal models. | Kitchen scenes; requires transfer. | Pre-train task sequence recogniser. | Household bias. |
| child_safety_monitoring | domain | [Rail Child Safety Set](https://rail-safety.example.com/child) | Restricted | 500 clips | RGB video | Indoor | Annotated guardian proximity. | Privacy-sensitive; limited release. | Train unattended child rule heuristics. | Limited age diversity. |
| child_safety_monitoring | scale | [MOTCha (Child Action)](https://motchallenge.net/) | CC BY-NC-SA 4.0 | 10 sequences | RGB video | Indoor | Child tracking ground truth. | Small dataset. | Improve child-specific trackers. | Museum/campus scenes. |
| vandalism_detection | domain | [Rail Vandalism Archive](https://rail-security.example.com/vandalism) | Restricted | 700 clips | RGB video | Outdoor | Graffiti, hammering, panel damage cases. | Requires legal clearance. | Rule tuning for vandalism detection. | Urban focus. |
| vandalism_detection | scale | [Graffiti Dataset](https://github.com/dubska/mgraffiti) | CC BY-SA 4.0 | 2,000 images | RGB stills | Outdoor | High-quality graffiti annotations. | Still images only. | Pre-train vandalism classifier. | Street art oriented. |
| panic_alarm_validation | domain | [Rail Panic Drill Dataset](https://rail-ops.example.com/panic) | Internal | 300 drills | RGB video + MQTT logs | Indoor | Synced button presses with video. | Simulated events; few real incidents. | Correlate external signals with visuals. | Operator training bias. |
| panic_alarm_validation | scale | [VERA MultiModal](https://vera-mmdb.org) | Custom | 1TB multimodal | Video+Audio+Sensors | Indoor | Rich sensor-video alignment. | Complex licensing. | Benchmark signal correlation pipelines. | Primarily lab scenarios. |
| calling_out_signal_aspect | domain | [Loco Signal Callouts](https://rail-loco.example.com/signals) | Restricted | 650 clips | RGB video + audio | Indoor | Annotated gestures + verbal callouts. | Audio privacy restrictions. | Validate signal aspect detection + callouts. | Single railway operator. |
| calling_out_signal_aspect | scale | [RailSim Synthetic Signals](https://railsim.example.com) | CC BY-NC 4.0 | 5k synthetic clips | RGB video | Outdoor | Controlled gestures with labels. | Synthetic domain gap. | Pre-train gesture recogniser. | Simulator textures. |
| hand_gesture_signal_identification | domain | [Indian Rail Hand Signals](https://indianrailways.gov.in/hand-signals) | Government Open Data | 1.1k clips | RGB video | Outdoor | Official gestures with metadata. | Variable resolution. | Train gesture classifier. | Regional variations minimal. |
| hand_gesture_signal_identification | scale | [EgoGesture](http://vip.bu.edu/projects/egogesture-dataset/) | Research only | 24k gestures | RGB+D video | Indoor | Large-scale gestures for backbone pretraining. | Egocentric viewpoint difference. | Transfer learning for hand pose. | Lab-captured gestures. |
| emergency_brake_valve_spad | domain | [SPAD Event Archive](https://rail-safety.example.com/spad) | Restricted | 250 events | RGB video + telemetry | Indoor | Brake valve interactions with telemetry alignment. | Highly sensitive. | Correlate valve interaction with MQTT signals. | Mostly passenger locomotives. |
| emergency_brake_valve_spad | scale | [MUGV Hand-Object Interaction](https://mugv-dataset.example.com) | CC BY-NC 4.0 | 5k sequences | RGB video | Indoor | Hand-object actions for transfer learning. | Non-rail objects. | Recognize valve grip gestures. | Lab environment. |
| mobile_phone_usage_detection | domain | [Loco Cab Distraction Dataset](https://rail-ops.example.com/distraction) | Restricted | 700 clips | RGB video | Indoor | Annotated phone usage in driver cabins. | Privacy gating required. | Train phone detection and hand-to-face heuristics. | Driver demographics skew male. |
| mobile_phone_usage_detection | scale | [Distracted Driver Dataset](https://www.kaggle.com/c/state-farm-distracted-driver-detection) | CC BY-NC-SA 4.0 | 64k images | RGB stills | Indoor | Rich hand-to-face/phone poses. | Dashboard camera angle. | Pre-train distraction classifier. | Auto interior bias. |
<!-- auto:end -->

Manual guidance:
- Record forensics datasets in addition to training splits.
# Implementation Status – 2025-10-31

This document summarises the current state of the Aixavier Edge Analytics stack so a new engineer (human or assistant) can resume work without digging through code history.

**Status:** Demo-ready for 8 workloads; production requires real models, secrets, and CI hygiene. See [`docs/next_steps.md`](docs/next_steps.md) for prioritized roadmap and [`docs/placeholders.md`](docs/placeholders.md) for live placeholder status. For onboarding, see the [README](../README.md).

## Services Overview

| Service                     | Code Path                                                       | Status           | Notes                                                                                                                          |
| --------------------------- | --------------------------------------------------------------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| ingest                      | `src/ingest_gst/`                                               | Demo-ready       | Synthetic + RTSP + `webcam://` capture (needs on-device validation).                                                           |
| detect_object               | `src/runners/` (config: `configs/detectors/object.yaml`)        | ONNX/TRT-capable | Uses shared runner with ONNX fallback and SimpleTracker IDs; requires production engines.                                      |
| detect_pose                 | `src/runners/` (config: `configs/detectors/pose_velocity.yaml`) | ONNX/TRT-capable | Pose events aligned with object tracks via cached detections; needs real models.                                               |
| detect_face / detect_action | `src/runners/`                                                  | Simulated        | Still emit synthetic events; promote to real inference later.                                                                  |
| tracker                     | `src/trackers/`                                                 | ByteTrack-lite   | ByteTrack-style matcher with Simple fallback; ReID still pending.                                                              |
| rules                       | `src/rules/engine.py`                                           | Demo-ready       | Dwell logic fixed; other rule types awaiting real data.                                                                        |
| recorder                    | `src/recorder/`                                                 | Stub             | Writes JSON; replace with video circular buffer.                                                                               |
| privacy                     | `src/privacy/`                                                  | Stub             | Enrollment + embeddings need hardened store/RBAC.                                                                              |
| exporter                    | `src/exporter/`                                                 | Stub             | Emits simulated metrics; wire to real telemetry.                                                                               |
| ui                          | `src/ui/`                                                       | Basic            | FastAPI endpoints + Streamlit; requires full dashboard build-out.                                                              |
| ui                          | `src/aixavier/ui/`                                              | Basic            | FastAPI endpoints for ROI editor, event browser, and toggles. See module README for API details. Frontend integration planned. |

## Use Case Catalog (22 total)

Use-case metadata is tracked centrally in `assets/usecases/catalog.yaml` (auto-parsed from `All Data Analytics use cases for CCTV under POC.xlsx`) and wired into `src/aixavier/core/usecases.py`. The registry surfaces every workload, their applicability, and now feeds the rule engine + docs in a single place.

### Stage Tracker

| #   | Use Case                                                                                                                   | Stage      | Notes                                                                                                   |
| --- | -------------------------------------------------------------------------------------------------------------------------- | ---------- | ------------------------------------------------------------------------------------------------------- |
| 1   | Trespassing on Railway Track                                                                                               | demo-ready | Uses object detector + ByteTrack in demo profile.                                                       |
| 2   | Stone pelting                                                                                                              | simulated  | Needs action detector + projectile heuristics; current runner emits synthetic action events.            |
| 3   | Camera tampering                                                                                                           | demo-ready | Blur/scene-change rules active via tamper detector.                                                     |
| 4   | People Counting & Occupancy in Locomotives                                                                                 | demo-ready | Object detector + tracker cover threshold counts; needs calibration for real density.                   |
| 5   | Smoke/Fire detection &  Haze / reduction in visibility detection                                                           | demo-ready | Object detector with placeholder smoke config; requires real fire/haze models.                          |
| 6   | Object Identification and classify                                                                                         | planned    | Requires banned-object classifier + rulepack tuning.                                                    |
| 7   | Securing of Coach Doors and the electrical panels in the doorway area.                                                     | planned    | Needs door state/geo-fencing inputs; no telemetry ingestion yet.                                        |
| 8   | Medical emergency detection in Circulation Area                                                                            | demo-ready | Pose detector + velocity drop heuristics wired in demo profile.                                         |
| 9   | Railway Staff Movement (Security Patrol and maintenance staff including coach attendants) Detection during train operation | planned    | Depends on ReID embeddings + tracker persistence (OSNet not wired).                                     |
| 10  | On demand viewing of cameras                                                                                               | planned    | UI/exporter need live switching & secure proxy; only basic API exists.                                  |
| 11  | Unattended baggage detection in circulation area                                                                           | demo-ready | Object dwell rule active; tune timers for real scenes.                                                  |
| 12  | Human aggression or violence detection                                                                                     | simulated  | Action detector simulated; X3D/MobileNet engines not integrated.                                        |
| 13  | Passenger falling from door in moving train                                                                                | planned    | Needs pose + action fusion with GPS speed gate; not wired.                                              |
| 14  | Face Recognition                                                                                                           | partial    | SCRFD/ArcFace pipeline stubbed; privacy service stores encrypted embeddings but matching logic limited. |
| 15  | Cleaning & hygiene monitoring in Circulation Area                                                                          | planned    | Requires change-detection model + ROI config; not implemented.                                          |
| 16  | Child safety monitoring                                                                                                    | planned    | Needs child-specific tracker/dwell logic + guardian detection.                                          |
| 17  | Vandalism detection                                                                                                        | planned    | Needs change/action detectors + ROI masks; not implemented.                                             |
| 18  | Validation of Panic alarm                                                                                                  | planned    | Requires telemetry ingestion + camera correlation; not implemented.                                     |
| 19  | Calling (voice) out signal aspect                                                                                          | planned    | Audio ingestion + ASR classifier missing.                                                               |
| 20  | Hand gesture (for identification of signal)                                                                                | simulated  | Pose runner exists but gesture classifier not trained; rulepack placeholder.                            |
| 21  | Emergency Brake Valve (RS value) operation during SPAD                                                                     | planned    | Needs telemetry + object recognition on cab cameras; not implemented.                                   |
| 22  | Mobile Phone Usage detection                                                                                               | simulated  | Pose/gesture logic missing; action runner simulated.                                                    |

**Snapshot:** 8/22 use cases produce demo events today, 5 rely on simulated detectors, and 9 remain in planning/backlog. Use `UseCaseRegistry().summary()` to pull this table programmatically during CI/tests.

### Applicability / Detector View

| #   | Use Case                                                               | Applicability   | Deployment               | Maturity   | Detectors           |
| --- | ---------------------------------------------------------------------- | --------------- | ------------------------ | ---------- | ------------------- |
| 1   | Trespassing on Railway Track                                           | Loco            | Post Incident Need Based | demo-ready | object, tracker     |
| 2   | Stone pelting                                                          | Loco            | Post Incident Need Based | planned    | object, action      |
| 3   | Camera tampering                                                       | All             | Real Time.               | demo-ready | integrity           |
| 4   | People Counting & Occupancy in Locomotives                             | All             | Real Time.               | demo-ready | object, tracker     |
| 5   | Smoke/Fire detection &  Haze / reduction in visibility detection       | All             | Real Time.               | demo-ready | environment, object |
| 6   | Object Identification and classify                                     | Coach and Locos | Real time.               | planned    | object              |
| 7   | Securing of Coach Doors and the electrical panels in the doorway area. | Coach           | Real time.               | planned    | object, telemetry   |
| 8   | Medical emergency detection in Circulation Area                        | Coach           | Real time.               | demo-ready | pose                |
| 9   | Railway Staff Movement ...                                             | Coach           | Real time.               | planned    | reid, tracker       |
| 10  | On demand viewing of cameras                                           | All             | Both                     | planned    | observability       |
| 11  | Unattended baggage detection in circulation area                       | Coach           | Both                     | demo-ready | object, dwell       |
| 12  | Human aggression or violence detection                                 | All             | Both                     | planned    | action              |
| 13  | Passenger falling from door in moving train                            | All             | Real time.               | planned    | pose, action        |
| 14  | Face Recognition                                                       | All             | Both                     | partial    | frs                 |
| 15  | Cleaning & hygiene monitoring in Circulation Area                      | Coach           | Both                     | planned    | object, change      |
| 16  | Child safety monitoring                                                | Coach           | Both                     | planned    | tracker, dwell      |
| 17  | Vandalism detection                                                    | Coach and Locos | Both                     | planned    | object, action      |
| 18  | Validation of Panic alarm                                              | Coach           | Real time.               | planned    | telemetry, object   |
| 19  | Calling (voice) out signal aspect                                      | Loco            | Both                     | planned    | audio               |
| 20  | Hand gesture (for identification of signal)                            | Loco            | Both                     | planned    | pose, action        |
| 21  | Emergency Brake Value ... SPAD                                         | Loco            | Both                     | planned    | object, telemetry   |
| 22  | Mobile Phone Usage detection                                           | Loco            | Both                     | planned    | pose, action        |

## Models & Assets

- Place ONNX exports under modality folders (`models/object/onnx`, `models/pose/onnx/rtmpose_onnx`, `models/action/onnx`, etc.); promote TensorRT engines into `models/usecases/<use-case>/fp16|int8/` only when they are production-ready.
- Stage production TensorRT engines under `models/usecases/<use-case>/fp16/` (INT8 later).
- `models/pose/TODO.md` and `models/object/TODO.md` track outstanding work for the two active use cases.
- Calibration datasets should live under `models/<modality>/calib/`.
- `configs/detectors/pose_velocity.yaml` now embeds a `person_detector` block (yolov11n by default) so RTMPose runs in a top-down, multi-person configuration—each detected person is cropped before pose inference.

### Model Group Strategy

Group shared models by analytic modality, keep raw ONNX/checkpoints beneath `models/<group>/`, and reserve `models/usecases/<slug>/` for deployable engines + INFO.md metadata. Recommended groups (covering both existing + future workloads):

| Group                       | Folder                                               | Use cases served            | Notes                                                                                                                                                           |
| --------------------------- | ---------------------------------------------------- | --------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Object detection / tracking | `models/object/...` (ONNX) + shared tracker configs  | 1,4,5,6,7,11,15,16,17,18,21 | Backed by yolov11/YOLOv10 exports; tracker tuned via `configs/tracker.yaml`.                                                                                    |
| Pose & velocity             | `models/pose/onnx/rtmpose_onnx/...`                  | 8,13,20,22                  | RTMPose ONNX feeds TRT engines under `models/usecases/pose/`; multi-person crops come from the shared YOLO person detector (`models/object/onnx/yolo11n.onnx`). |
| Action / clip analytics     | `models/action/onnx/...`                             | 2,12,13,17,20,22            | Hosts X3D-S, MobileNet-TSM, gesture classifiers. Current services still simulated—wire TRT engines + calibration here.                                          |
| Face / ReID                 | `models/face/...`, `models/reid/...`                 | 9,14                        | SCRFD + ArcFace + OSNet_x0_25 assets live here; upgrade once production engines ready.                                                                          |
| Audio / ASR                 | `models/audio/...`                                   | 19                          | Placeholder for future speech-recognition weights used in calling-out-signal-aspect detection.                                                                  |
| Telemetry fusion helpers    | `models/telemetry/...` (placeholder configs/scripts) | 7,18,21                     | Holds ML models or rule scripts that combine vision with door/RS telemetry; currently empty but documented for future work.                                     |

Nothing needs to be deleted: keep the modality folders (`models/object`, `models/pose`, `models/action`, `models/face`, `models/reid`, etc.) and gradually migrate ONNX exports into them. Only place fully vetted TensorRT engines (and their checksums/INFO.md) into `models/usecases/<slug>/`. This keeps the repo lightweight while still exposing a predictable locker for deployment artifacts.

## Tracking & Pose Association

- `SimpleTracker` assigns persistent IDs per camera and caches the latest object detections under `artifacts/detections/cache/<camera>.json`.
- Pose detections reuse cached `person` boxes for track association; accuracy will improve once ByteTrack + ReID is added.

## Tests & CI Gating

- `pytest` suite covers rule engine, tracker, and (optionally) detector post-processing. Set `AIXAVIER_ENABLE_NUMPY_TESTS=1` when NumPy is available to enable ONNX layout tests.
- Add integration tests once real models are staged.
- **Placeholder hygiene is enforced in CI:**
	- The placeholder linter (`tools/placeholder_lint.py`) and smoke test (`tests/test_placeholders_smoke.py`) ensure all secrets and placeholders are either resolved or documented in [`docs/placeholders.md`](docs/placeholders.md).
	- The linter ignores `.venv/`, `site-packages`, and other non-project paths for reliability.
	- CI will fail if unresolved placeholders or undocumented secrets are found.

## Outstanding Work (High Level)

1. Replace simulated face/action detectors with real inference pipelines.
2. Integrate ByteTrack + OSNet ReID for production-grade tracking.
3. Deploy recorder (video), exporter (metrics), privacy (embeddings) with real functionality.
4. Resolve all placeholders via `.env` and the placeholder resolver before production builds.
5. Harden docs/CI: run detector integration tests and enforce placeholder gate in `agent-ci` workflow.
6. INT8 calibration for detectors (object + pose) once datasets are ready.

Refer to `docs/next_steps.md` for the detailed roadmap and `HANDOFF.md` for chronological change logs.
# Models

This document is maintained by the agent. Manual notes belong outside auto sections.

<!-- auto:start name=models-matrix -->
| Task                 | Model                 | Backbone/Size                | Training Data                       | Benchmark                  | Latency (FP16/INT8 ms) | VRAM (GB) | Params (M) | License    | Why pick                                                                                        | Links                                                |
| -------------------- | --------------------- | ---------------------------- | ----------------------------------- | -------------------------- | ---------------------- | --------- | ---------- | ---------- | ----------------------------------------------------------------------------------------------- | ---------------------------------------------------- |
| face_recognition     | MobileFaceNet ArcFace | MobileFaceNet                | Glint360K                           | LFW / IJB-C TAR@FAR=1e-4   | 2.10/1.50              | 0.40      | 1.30       | MIT        | Lightweight embeddings yield sub-3 ms inference with acceptable verification accuracy.          | https://github.com/deepinsight/insightface           |
| reid                 | OSNet_x0_25           | OSNet x0.25                  | MSMT17 + pretrain                   | MSMT17 mAP                 | 1.90/1.30              | 0.35      | 0.70       | MIT        | Tiny footprint while keeping >50% mAP for staff tracking/association.                           | https://github.com/KaiyangZhou/deep-person-reid      |
| face_detection       | SCRFD-500M            | Custom (MobileNet)           | WiderFace                           | WiderFace easy/medium/hard | 6.20/4.10              | 0.90      | 0.50       | MIT        | Best balance of recall vs throughput for FRS entry point; stable InsightFace tooling.           | https://github.com/deepinsight/insightface           |
| fire_smoke_detection | EfficientNet-B0 Fire  | EfficientNet-B0              | FIReS + custom rail smoke           | FIReS F1                   | 9.80/6.70              | 1.00      | 5.30       | Apache-2.0 | Temporal smoothing friendly; consistent with haze detection heuristics.                         | https://github.com/google/automl                     |
| violence_detection   | MobileNet-TSM         | MobileNetV2 + Temporal Shift | RWF-2000                            | RWF-2000 accuracy          | 12.90/9.00             | 1.10      | 2.20       | Apache-2.0 | Use when action queue saturates; 30% lighter than X3D-S.                                        | https://github.com/mit-han-lab/temporal-shift-module |
| pose_estimation      | yolov11n-pose         | yolov11 nano pose            | COCO keypoints                      | COCO AP                    | 11.30/7.90             | 1.40      | 3.00       | GPLv3      | Supports skeleton velocity pipeline with unified pre-processing with detector.                  | https://github.com/ultralytics/ultralytics           |
| object_detection     | YOLOv10n              | YOLOv10 nano                 | COCO 2017                           | COCO mAP@0.5:0.95          | 7.40/4.90              | 1.30      | 3.30       | GPLv3      | Edge-optimised upgrade with minor latency gain and better mAP; requires latest TensorRT parser. | https://github.com/THU-MIG/yolov10                   |
| object_detection     | yolov11n              | yolov11 nano                 | COCO 2017                           | COCO mAP@0.5:0.95          | 8.10/5.20              | 1.20      | 3.20       | GPLv3      | Baseline detector with mature TensorRT export path and excellent throughput on Xavier.          | https://github.com/ultralytics/ultralytics           |
| violence_detection   | X3D-S                 | X3D                          | Kinetics-400 fine-tuned on RWF-2000 | RWF-2000 accuracy          | 18.40/12.60            | 1.60      | 3.80       | Apache-2.0 | High recall for aggression with manageable latency using clip_stride=2.                         | https://github.com/facebookresearch/pytorchvideo     |
| open_vocabulary      | YOLO-World-s          | YOLO-World small             | Objects365 + ImageNet-22K           | OVAD mAP                   | 15.60/11.10            | 1.80      | 11.00      | Apache-2.0 | Optional exploratory classes for post-incident analytics; disabled by default.                  | https://github.com/AILab-CVC/YOLO-World              |
<!-- auto:end -->

Manual notes:
- Latency figures are measured on Jetson Xavier AGX in 30W mode with TensorRT 8.6; expect ±10% variance based on thermal budget.
- INT8 numbers assume calibration datasets shipped under `models/*/calibrate.sh`.
- Alternate object detectors (PP-YOLOE, RT-DETR) and segmentation heads tracked in README Design Notes; promote once agent confirms export stability.
- The detector runtime can fall back to ONNX exports in `models/object/onnx/` and `models/pose/onnx/` when TensorRT engines are unavailable—useful for CPU validation before staging production engines under `models/usecases/`.
# Next Steps – Aixavier Edge Analytics Stack
_Date: 2025-11-09_

## TL;DR

**Verdict:** The repo is **demo-ready** for the eight workloads covered by the current detectors/rules and now carries a **single source of truth for all 22 analytics use cases** via the new manifest/registry. We are still **not production-ready**: face/action detectors stay simulated, secrets remain unresolved (40 placeholders), model bootstrap only creates placeholders, and CI would fail the placeholder hygiene gate.

**Onboarding:** See [`docs/IMPLEMENTATION_STATUS.md`](docs/IMPLEMENTATION_STATUS.md) for live service/model status, [`docs/placeholders.md`](docs/placeholders.md) for placeholder hygiene, and the [README](../README.md) for quickstart and contribution rules.

Recent work (2025-11-09):
- Parsed `All Data Analytics use cases for CCTV under POC.xlsx` into `assets/usecases/catalog.yaml` and surfaced it through `src/aixavier/core/usecases.py` so rules/tests/CLI can reason over all 22 workloads.
- Taught `src/rules/engine.py` to hydrate metadata from the registry (complete with `summary()`), ensuring even unimplemented workloads appear in reports.
- Updated docs and configs to pull ONNX weights from modality folders (`models/pose/onnx/...`) and kept TensorRT promotion under `models/usecases/<slug>/`.
- Carried forward earlier detector-and-runner fixes (object + pose ONNX/TRT runtime) plus demo profile wiring.

---

## What I checked
- Repository structure, code modules in `src/`, Dockerfiles, and `docker-compose.yml`.
- Configs under `configs/`, docs under `docs/`, deploy assets (`deploy/`), and Makefile targets.
- Tests in `tests/` and CI workflows in `.github/workflows/`.
- Presence of placeholder secrets and placeholder-resolver tooling.
- `All Data Analytics use cases for CCTV under POC.xlsx` → generated manifest at `assets/usecases/catalog.yaml` and cross-checked that every slug matches the existing `configs/usecases/*.yaml` files.

## Services & modules at a glance
**Compose services (14):** ingest, detect_object, detect_pose, detect_face, detect_action, tracker, rules, events, privacy, recorder, ui, exporter, agent, demo_rtsp

**Makefile targets:** agent:refresh, bootstrap, ci, clean, demo, format, help, lint, perf, placeholders:check, placeholders:list, placeholders:resolve, run, run-detached, stop, test

### Component readiness matrix
| Component  | main/app | Dockerfile | In compose | Tests | Status                                                 |
| ---------- | -------: | ---------: | ---------: | ----: | ------------------------------------------------------ |
| agent      |        ✅ |          ✅ |          ✅ |     — | Demo-ready (no tests)                                  |
| common     |        — |          — |          — |     ✅ | Library                                                |
| events     |        ✅ |          ✅ |          ✅ |     ✅ | Demo-ready                                             |
| exporter   |        ✅ |          ✅ |          ✅ |     — | Demo-ready (simulated metrics)                         |
| ingest_gst |        ✅ |          ✅ |          ✅ |     — | Demo-ready (RTSP + webcam); needs on-device validation |
| privacy    |        ✅ |          ✅ |          ✅ |     — | Demo-ready (simulated matching)                        |
| recorder   |        ✅ |          ✅ |          ✅ |     — | Demo-ready (JSON stubs)                                |
| rules      |        ✅ |          ✅ |          ✅ |     ✅ | Demo-ready                                             |
| runners    |        ✅ |          ✅ |          ✅ |     ✅ | Object/Pose operational; face/action simulated         |
| trackers   |        ✅ |          ✅ |          ✅ |     ✅ | Demo-ready (ByteTrack-lite; add ReID later)            |
| ui         |        ✅ |          ✅ |          ✅ |     ✅ | Demo-ready                                             |

Notes:
- `runners` powers four services (`detect_object`, `detect_pose`, `detect_face`, `detect_action`); object/pose use the shared detector runtime, while face/action remain simulated.
- `trackers` now assigns stable IDs via `SimpleTracker` (IoU-based); replace with ByteTrack + ReID when production ready.
- `recorder` writes JSON artifacts, not video; `exporter` reports **simulated** metrics; `ui` is a minimal FastAPI API.
- `ingest_gst` produces frames from synthetic/demo sources; RTSP/ONVIF capture paths are present but need validation on-device.
- Production-ready TensorRT engines should be staged under `models/usecases/<use-case>/` and referenced from `configs/detectors/*.yaml` before shipping.

## Placeholder & secrets inventory
- **Distinct placeholders:** **40**  
  (Run `make placeholders:list` and `make placeholders:check` to validate; current linter reports failures.)
- Examples: CAMERA_ONVIF_HOST_01, CAMERA_ONVIF_PASS, CAMERA_ONVIF_USER, CAMERA_RTSP_URL_01, DATASET_PATH_FACE_CALIB, DATASET_PATH_FIRE_SMOKE, DATASET_PATH_OBJECT_CALIB, DATASET_PATH_POSE_CALIB, DATASET_PATH_REID_CALIB, DATASET_PATH_VIOLENCE, EVENTS_REST_ENDPOINT, FRS_BLACKLIST_EMBEDDING_01…

> Resolution flow: copy `.env.example` → `.env`, then `make placeholders:resolve FROM=.env` to render into `configs/*`. Keep real secrets out of Git.

## Gaps & recommended next steps (by area)

### P0 — Must-have to implement real deployments
1. **Bridge the 14 planned (non demo-ready) use cases surfaced by the registry**  
   - Use `UseCaseRegistry.summary()` (or the table in `docs/IMPLEMENTATION_STATUS.md`) to track progress per slug.  
   - Assign detector owners for audio (`calling_out_signal_aspect`), telemetry joiners (`coach_door_panel_security`, `panic_alarm_validation`, `emergency_brake_valve_spad`), and action/pose-heavy workloads (stone pelting, child safety, vandalism, mobile phone usage).
2. **Remaining detector modalities (TensorRT + DeepStream)**  
   - Promote **face** and **action** detectors from simulation to model-backed inference.  
   - Wire engines exported via `models/*/export_trt.sh` (and stage under `models/usecases/`) so docker services pick them up automatically.
2. **Live ingest over RTSP/ONVIF**  
   - Validate `src/ingest_gst/pipeline.py` on Jetson (reconnects, FPS limiting, NVMM zero-copy).  
   - Confirm ONVIF time-sync and per-camera configs in `configs/cameras.yaml`.
3. **Tracking**  
   - ByteTrack-lite is in place; next step is wiring OSNet ReID and validating long-term ID stability across cameras/occlusions.
4. **Rules engine completeness**  
   - Finish all rule handlers in `src/rules/engine.py` (ROI, lines, dwell, velocity drop, trespass, action-score, etc.). Current tests cover basics only.  
   - Validate rulepack YAMLs under `configs/usecases/*.yaml` against real events.
5. **Recorder (circular video buffers)**  
   - Replace JSON stubs with real pre/post video clip spooling, watermarking, hashing, and export manifests.
6. **Privacy & FRS**  
   - Implement encrypted embedding store in `src/privacy/store.py`, FastAPI endpoints for enrollment/match/whitelist/blacklist, and RBAC enforcement.  
   - Honor per-camera privacy settings (blur non-matches; approval for exports).
7. **Exporter / Observability**  
   - Replace simulated metrics with NVML/tegrastats readings, detector latency histograms, and per-camera FPS.  
   - Confirm Prometheus scrape on `PROMETHEUS_SCRAPE_PORT` and ship Grafana dashboard (`deploy/grafana/edge-cctv.json`).
8. **Secrets & placeholders**  
   - Resolve **all 40 placeholders** and commit only templates. Gate CI on `make placeholders:check`.

### P1 — Quality, safety, & ops
- **End-to-end tests on Xavier (AGX/NX)**: RTSP smoke (`tests/test_rtsp_connect.sh`) plus golden-event assertions for a few rulepacks.  
- **CI hardening**: Expand `.github/workflows/agent-ci.yml` to build container images and run headless tests; fail PRs on unresolved placeholders, lint, and mypy.  
- **Container baselines**: Ensure `nvcr.io/nvidia/l4t-base:35.4.1` aligns with the installed JetPack; pin DeepStream images.  
- **Deployment**: Validate `deploy/systemd/*.service` units on-device; confirm volumes (`/data/recordings`, `/data/exports`, logs) ownership and quota/retention.  
- **Security**: OAuth/OIDC proxy in front of UI, short‑lived JWTs, mTLS for events REST when used over WAN; secret scanning in CI.

### P2 — UX & docs
- **UI**: FastAPI endpoints for ROI editor, event browser, and toggles are now scaffolded (`src/aixavier/ui/`). Mount the router in your app or use the Compose service. Next: add frontend components and integrate with event pipeline.
- **Docs**: Flesh out `docs/SETUP.md`, `PRIVACY.md`, and `TROUBLESHOOT.md` with concrete JetPack/DeepStream versions and gotchas, and keep `docs/IMPLEMENTATION_STATUS.md`/`assets/usecases/catalog.yaml` in sync when the spreadsheet changes.  
- **README**: Replace the placeholder sections (auto blocks) after the maintainer agent writes first real tables.

## Evidence (auto-collected)

### Compose services
- ingest
- detect_object
- detect_face
- detect_action
- tracker
- rules
- events
- privacy
- recorder
- ui
- exporter
- agent
- demo_rtsp

### Makefile targets
- `agent:refresh`
- `bootstrap`
- `ci`
- `clean`
- `demo`
- `format`
- `help`
- `lint`
- `perf`
- `placeholders:check`
- `placeholders:list`
- `placeholders:resolve`
- `run`
- `run-detached`
- `stop`
- `test`

### Placeholders (complete list, with sample locations)
- **{{CAMERA_ONVIF_HOST_01}}** — e.g., .env.example
- **{{CAMERA_ONVIF_PASS}}** — e.g., .env.example
- **{{CAMERA_ONVIF_USER}}** — e.g., .env.example
- **{{CAMERA_RTSP_URL_01}}** — e.g., .env.example
- **{{DATASET_PATH_FACE_CALIB}}** — e.g., .env.example
- **{{DATASET_PATH_FIRE_SMOKE}}** — e.g., .env.example
- **{{DATASET_PATH_OBJECT_CALIB}}** — e.g., .env.example
- **{{DATASET_PATH_POSE_CALIB}}** — e.g., .env.example
- **{{DATASET_PATH_REID_CALIB}}** — e.g., .env.example
- **{{DATASET_PATH_VIOLENCE}}** — e.g., .env.example
- **{{EVENTS_REST_ENDPOINT}}** — e.g., .env.example
- **{{FRS_BLACKLIST_EMBEDDING_01}}** — e.g., docs/placeholders.md
- **{{FRS_BLACKLIST_NAME_01}}** — e.g., docs/placeholders.md
- **{{FRS_BLACKLIST_REASON_01}}** — e.g., docs/placeholders.md
- **{{FRS_ENROLLMENT_OPERATOR_NAME}}** — e.g., .env.example
- **{{FRS_STAFF_EMBEDDING_01}}** — e.g., docs/placeholders.md
- **{{FRS_STAFF_EMPLOYEE_ID_01}}** — e.g., docs/placeholders.md
- **{{FRS_STAFF_NAME_01}}** — e.g., docs/placeholders.md
- **{{FRS_THRESHOLD}}** — e.g., .env.example
- **{{FRS_WHITELIST_EMBEDDING_01}}** — e.g., docs/placeholders.md
- **{{FRS_WHITELIST_EXPIRY_01}}** — e.g., docs/placeholders.md
- **{{FRS_WHITELIST_NAME_01}}** — e.g., docs/placeholders.md
- **{{GIT_REMOTE_URL}}** — e.g., .env.example
- **{{INSTALL_PREFIX}}** — e.g., .env.example
- **{{METRICS_PUSH_URL}}** — e.g., .env.example
- **{{MQTT_BROKER_HOST}}** — e.g., .env.example
- **{{MQTT_BROKER_PASS}}** — e.g., .env.example
- **{{MQTT_BROKER_URL}}** — e.g., .env.example
- **{{MQTT_BROKER_USER}}** — e.g., .env.example
- **{{ORG_NAME}}** — e.g., README.md
- **{{PLACEHOLDER}}** — e.g., README.md
- **{{PROMETHEUS_SCRAPE_PORT}}** — e.g., README.md
- **{{RETENTION_DAYS}}** — e.g., .env.example
- **{{SEC_EXPORT_ENCRYPTION_KEY}}** — e.g., .env.example
- **{{STORAGE_CLIPS_PATH}}** — e.g., .env.example
- **{{STORAGE_EXPORT_PATH}}** — e.g., .env.example
- **{{TIME_SYNC_SOURCE}}** — e.g., .env.example
- **{{UI_ADMIN_PASS}}** — e.g., .env.example
- **{{UI_ADMIN_USER}}** — e.g., .env.example
- **{{UI_HOST}}** — e.g., .env.example
- **{{UI_PORT}}** — e.g., .env.example
- **{{UPPER_SNAKE_CASE}}** — e.g., tools/resolve_placeholders.py

### Tests present
- `tests/test_rules.py` — rule engine triggers  
- `tests/test_tracker.py` — SimpleTracker + ByteTrack-lite behaviours  
- `tests/test_tracker_manager.py` — TrackerManager (ByteTrack/simple lifecycle)  
- `tests/test_pose_assoc.py` — pose-to-person association logic  
- `tests/test_event_bus.py` — FileEventBus enqueue/persist  
- `tests/test_healthcheck.py` — ingest healthcheck success/failure  
- `tests/test_exporter.py` — pose event counting (auto-skips if `prometheus_client` missing)  
- `tests/test_detectors.py` — ONNX/TensorRT output normalisation (skipped unless `AIXAVIER_ENABLE_NUMPY_TESTS=1`)  
- `tests/test_perf.py` — metrics scrape parser  
- `tests/test_rtsp_connect.sh` — RTSP connectivity smoke  
(Overall test coverage is still low, but the most critical plumbing now has unit tests.)

## Quick “go / no‑go”
- **Go for demo**: You can run `make demo` locally and see synthetic events flow through the stack.  
- **No‑go for production**: Replace simulations, finalize privacy/recording, and resolve secrets before real deployments.

---

> See also `docs/IMPLEMENTATION_STATUS.md` for a condensed snapshot of services/models and `models/*/TODO.md` for per-use-case checklists.

_This file was generated by inspecting the repository snapshot only; no internet access or external builds were run._
# Performance

## Target
- Single 1080p H.265 RTSP stream per Xavier
- ≥25 FPS end-to-end with all 22 analytics active
- GPU utilization <85%, CPU <75% sustained

## DeepStream Tuning
| Parameter | Minimal | Demo | All |
|-----------|---------|------|-----|
| `primary-gie` batch size | 1 | 1 | 2 |
| `interval` (object) | 0 | 1 | 1 |
| `interval` (face) | 0 | 1 | 1 |
| `interval` (action)` | 0 | 2 | 2 |
| `nvinfer` tensor-meta` | off | on | on |

- Enable `nvbuf-memory-type=3` to keep NVMM buffers zero-copy.
- Use `nvdsosd` in GPU mode to reduce CPU load.

## TensorRT Knobs
- Favor FP16 (already exported); INT8 when calibration dataset ready.
- Set `builder.max_workspace_size = 2 << 30` for large pose/action models.
- For INT8, use per-channel quantization when supported.

## CPU Affinity & NUMA
- Pin ingest and recorder threads to CPU0-1 using `taskset` (configured in containers).
- Dedicate CPU2-5 to detection/tracking; CPU6-7 to UI/agent.

## Thermal Budget
- Use `tegrastats --interval 1000` during soak tests.
- If temps exceed 80 °C, reduce action detector interval or enable downscale in `configs/cameras.yaml`.

## Expected Metrics
| Use Case | Detector Interval | FPS Contribution | Notes |
|----------|-------------------|------------------|-------|
| Tamper | 1 | ~0.5 ms CPU | pure image stats |
| Trespass | 1 | 8 ms GPU | YOLO + tracker |
| Unattended baggage | 2 | 4 ms GPU | shares YOLO detections |
| Violence | 3 | 6 ms GPU | X3D clip inference |
| FRS | 2 | 3 ms GPU | SCRFD + embedding |
| Medical collapse | 3 | 5 ms GPU | pose velocity |

## Storage & Retention
- Default retention: `{{RETENTION_DAYS}}` days; adjust per camera in `configs/cameras.yaml`.
- Recorder prunes oldest clips nightly; metrics exported via `storage_bytes_used` gauge.

## Benchmark Workflow
```bash
make perf
python tests/test_perf.py --endpoint http://localhost:9100/metrics --report artifacts/perf/latest.json
```
Outputs CSV + HTML summary in `artifacts/perf/` for trend analysis.

# Placeholders Inventory

**CI gating:** All secrets and placeholders must be resolved or documented here for builds to pass. The placeholder linter and smoke test (`tests/test_placeholders_smoke.py`) enforce this in CI. The linter ignores `.venv/`, `site-packages`, and other non-project paths for reliability.

_Current unresolved placeholders: 40 (see table below)._ Runtime metadata for all 22 analytics workloads now lives in `assets/usecases/catalog.yaml`, so no new placeholders were introduced for the registry. Detector services read ONNX files from the modality folders (`models/<modality>/onnx/...`) and promote TensorRT engines into `models/usecases/<use-case>/...`; populate those paths and update this index as new model-specific secrets are introduced.

<!-- auto:start name=placeholder-index -->
| Placeholder                      | File path(s)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Purpose                              | Required format / regex           | Example                                         | Security level | Who provides | When required | Default                    | Resolution status | Last updated |
| -------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------ | --------------------------------- | ----------------------------------------------- | -------------- | ------------ | ------------- | -------------------------- | ----------------- | ------------ |
| {{CAMERA_ONVIF_HOST_01}}         | .env.example<br>configs/cameras.yaml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ONVIF host/IP                        | `^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$` | 10.0.0.10                                       | secret         | Video team   | run           | none                       | unresolved        | 2025-10-07   |
| {{CAMERA_ONVIF_PASS}}            | .env.example<br>configs/cameras.yaml<br>docs/TROUBLESHOOT.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ONVIF password                       | `^.{8,}$`                         | ********                                        | secret         | Video team   | run           | none                       | unresolved        | 2025-10-07   |
| {{CAMERA_ONVIF_USER}}            | .env.example<br>configs/cameras.yaml<br>docs/TROUBLESHOOT.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | ONVIF username                       | `^[A-Za-z0-9_]+$`                 | cameraadmin                                     | secret         | Video team   | run           | none                       | unresolved        | 2025-10-07   |
| {{CAMERA_RTSP_URL_01}}           | .env.example<br>configs/cameras.yaml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Primary RTSP stream URL              | `^rtsp://.+$`                     | rtsp://10.0.0.10/stream1                        | secret         | Video team   | run           | none                       | unresolved        | 2025-10-07   |
| {{DATASET_PATH_FACE_CALIB}}      | .env.example<br>models/face/calibrate.sh                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Face calibration dataset             | `^/.+`                            | /data/datasets/face_calib                       | internal       | ML           | bootstrap     | none                       | unresolved        | 2025-10-07   |
| {{DATASET_PATH_FIRE_SMOKE}}      | .env.example                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Calibration dataset directory        | `^/.+`                            | /data/datasets/fire                             | internal       | ML           | bootstrap     | none                       | unresolved        | 2025-10-07   |
| {{DATASET_PATH_OBJECT_CALIB}}    | .env.example<br>models/object/calibrate.sh                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Object calibration dataset           | `^/.+`                            | /data/datasets/object_calib                     | internal       | ML           | bootstrap     | none                       | unresolved        | 2025-10-07   |
| {{DATASET_PATH_POSE_CALIB}}      | .env.example<br>models/pose/calibrate.sh                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Pose calibration dataset             | `^/.+`                            | /data/datasets/pose_calib                       | internal       | ML           | bootstrap     | none                       | unresolved        | 2025-10-07   |
| {{DATASET_PATH_REID_CALIB}}      | .env.example<br>models/reid/calibrate.sh                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | ReID calibration dataset             | `^/.+`                            | /data/datasets/reid_calib                       | internal       | ML           | bootstrap     | none                       | unresolved        | 2025-10-07   |
| {{DATASET_PATH_VIOLENCE}}        | .env.example<br>models/action/calibrate.sh                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Violence dataset path                | `^/.+`                            | /data/datasets/violence                         | internal       | ML           | bootstrap     | none                       | unresolved        | 2025-10-07   |
| {{EVENTS_REST_ENDPOINT}}         | .env.example<br>configs/usecases/camera_tampering.yaml<br>configs/usecases/coach_door_panel_security.yaml<br>configs/usecases/face_recognition.yaml<br>configs/usecases/human_aggression_violence.yaml<br>configs/usecases/people_counting_occupancy.yaml<br>configs/usecases/smoke_fire_haze.yaml<br>configs/usecases/trespassing_on_track.yaml<br>docs/PRIVACY.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | REST target for events               | `^https://.+$`                    | https://event-bus/api                           | secret         | Platform     | run           | none                       | unresolved        | 2025-10-07   |
| {{FRS_BLACKLIST_EMBEDDING_01}}   | configs/frs/blacklist.yaml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Base64 embedding                     | `^[A-Za-z0-9+/=]+$`               | QVNEMTI=                                        | secret         | Security     | run           | none                       | unresolved        | 2025-10-07   |
| {{FRS_BLACKLIST_NAME_01}}        | configs/frs/blacklist.yaml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Blacklisted identity name            | `^[A-Za-z ]+$`                    | Suspicious Person                               | secret         | Security     | run           | none                       | unresolved        | 2025-10-07   |
| {{FRS_BLACKLIST_REASON_01}}      | configs/frs/blacklist.yaml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Reason text                          | `^.{5,}$`                         | Trespass history                                | internal       | Security     | run           | none                       | unresolved        | 2025-10-07   |
| {{FRS_ENROLLMENT_OPERATOR_NAME}} | .env.example                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Operator attribution for enrollment  | `^[A-Za-z ]+$`                    | Priya Sharma                                    | secret         | Security     | run           | none                       | unresolved        | 2025-10-07   |
| {{FRS_STAFF_EMBEDDING_01}}       | configs/frs/staff_whitelist.yaml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Staff embedding                      | `^[A-Za-z0-9+/=]+$`               | QlJEUw==                                        | secret         | HR           | run           | none                       | unresolved        | 2025-10-07   |
| {{FRS_STAFF_EMPLOYEE_ID_01}}     | configs/frs/staff_whitelist.yaml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Employee ID                          | `^[A-Z0-9_-]+$`                   | AG1234                                          | internal       | HR           | run           | none                       | unresolved        | 2025-10-07   |
| {{FRS_STAFF_NAME_01}}            | configs/frs/staff_whitelist.yaml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Staff name                           | `^[A-Za-z ]+$`                    | Anita Singh                                     | public         | HR           | run           | none                       | unresolved        | 2025-10-07   |
| {{FRS_THRESHOLD}}                | .env.example<br>configs/frs/config.yaml<br>configs/usecases/face_recognition.yaml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | FRS similarity threshold             | `^0\.[0-9]{2}$`                   | 0.47                                            | public         | Security     | run           | 0.47                       | unresolved        | 2025-10-07   |
| {{FRS_WHITELIST_EMBEDDING_01}}   | configs/frs/whitelist.yaml<br>src/runners/main.py                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Base64 face embedding                | `^[A-Za-z0-9+/=]+$`               | QkNEMTA=                                        | secret         | Security     | run           | none                       | unresolved        | 2025-10-07   |
| {{FRS_WHITELIST_EXPIRY_01}}      | configs/frs/whitelist.yaml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Expiry date                          | `^20[0-9]{2}-[0-9]{2}-[0-9]{2}$`  | 2025-12-31                                      | public         | Security     | run           | 2099-12-31                 | unresolved        | 2025-10-07   |
| {{FRS_WHITELIST_NAME_01}}        | configs/frs/whitelist.yaml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Whitelisted identity name            | `^[A-Za-z ]+$`                    | Ravi Kumar                                      | secret         | Security     | run           | none                       | unresolved        | 2025-10-07   |
| {{GIT_REMOTE_URL}}               | .env.example<br>docs/SETUP.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Git remote for cloning               | `^https://.+\.git$`               | https://github.com/example/edge-cctv-jetson.git | public         | DevOps       | setup         | existing remote            | unresolved        | 2025-10-07   |
| {{INSTALL_PREFIX}}               | .env.example<br>deploy/systemd/detect.service<br>deploy/systemd/ingest.service<br>deploy/systemd/ui.service                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Install location for systemd units   | `^/.+`                            | /opt                                            | internal       | Ops          | prod          | /opt                       | unresolved        | 2025-10-07   |
| {{METRICS_PUSH_URL}}             | .env.example                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Optional pushgateway URL             | `^https?://.+$`                   | https://metrics-gw/push                         | internal       | Platform     | optional      | none                       | unresolved        | 2025-10-07   |
| {{MQTT_BROKER_HOST}}             | .env.example<br>docs/TROUBLESHOOT.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Broker hostname for CLI tools        | `^[A-Za-z0-9_.-]+$`               | 10.0.0.20                                       | secret         | Platform     | setup         | none                       | unresolved        | 2025-10-07   |
| {{MQTT_BROKER_PASS}}             | .env.example                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | MQTT auth password                   | `^.{12,}$`                        | ********                                        | secret         | Platform     | setup         | none                       | unresolved        | 2025-10-07   |
| {{MQTT_BROKER_URL}}              | .env.example<br>configs/usecases/calling_out_signal_aspect.yaml<br>configs/usecases/camera_tampering.yaml<br>configs/usecases/child_safety_monitoring.yaml<br>configs/usecases/cleaning_hygiene_monitoring.yaml<br>configs/usecases/coach_door_panel_security.yaml<br>configs/usecases/emergency_brake_valve_spad.yaml<br>configs/usecases/face_recognition.yaml<br>configs/usecases/hand_gesture_signal_identification.yaml<br>configs/usecases/human_aggression_violence.yaml<br>configs/usecases/medical_emergency_collapse.yaml<br>configs/usecases/mobile_phone_usage_detection.yaml<br>configs/usecases/object_identification_classification.yaml<br>configs/usecases/on_demand_viewing.yaml<br>configs/usecases/panic_alarm_validation.yaml<br>configs/usecases/passenger_falling_from_door.yaml<br>configs/usecases/people_counting_occupancy.yaml<br>configs/usecases/smoke_fire_haze.yaml<br>configs/usecases/staff_movement_tracking.yaml<br>configs/usecases/stone_pelting.yaml<br>configs/usecases/trespassing_on_track.yaml<br>configs/usecases/unattended_baggage.yaml<br>configs/usecases/vandalism_detection.yaml<br>docs/PRIVACY.md | MQTT broker URI                      | `^mqtts?://.+$`                   | mqtts://10.0.0.20:8883                          | secret         | Platform     | setup         | none                       | unresolved        | 2025-10-07   |
| {{MQTT_BROKER_USER}}             | .env.example                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | MQTT auth username                   | `^[A-Za-z0-9_\-]+$`               | edgeops                                         | secret         | Platform     | setup         | none                       | unresolved        | 2025-10-07   |
| {{ORG_NAME}}                     | .env.example<br>README.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Organization identifier for branding | `^[A-Z0-9_\-]+$`                  | METRO_RAIL_CORP                                 | public         | Ops          | setup         | none                       | unresolved        | 2025-10-07   |
| {{PROMETHEUS_SCRAPE_PORT}}       | .env.example<br>README.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | Exporter port                        | `^[0-9]{4,5}$`                    | 9100                                            | public         | Platform     | run           | 9100                       | unresolved        | 2025-10-07   |
| {{RETENTION_DAYS}}               | .env.example<br>configs/cameras.yaml<br>docs/PERFORMANCE.md<br>docs/PRIVACY.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Clip retention policy                | `^[0-9]+$`                        | 30                                              | public         | Ops          | prod          | 7                          | unresolved        | 2025-10-07   |
| {{SEC_EXPORT_ENCRYPTION_KEY}}    | .env.example<br>docs/PRIVACY.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Encryption key for exports           | `^[A-F0-9]{64}$`                  | DEADBEEF...                                     | secret         | Security     | prod          | none                       | unresolved        | 2025-10-07   |
| {{STORAGE_CLIPS_PATH}}           | .env.example<br>configs/cameras.yaml<br>docs/SETUP.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Clip storage mount                   | `^/.+`                            | /media/ssd/clips                                | internal       | Ops          | setup         | /var/lib/edge-cctv/clips   | unresolved        | 2025-10-07   |
| {{STORAGE_EXPORT_PATH}}          | .env.example<br>configs/cameras.yaml                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Export directory                     | `^/.+`                            | /media/ssd/exports                              | internal       | Ops          | setup         | /var/lib/edge-cctv/exports | unresolved        | 2025-10-07   |
| {{TIME_SYNC_SOURCE}}             | .env.example<br>deploy/flash-checklist.md<br>docs/SETUP.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | Time synchronization authority       | `^.+$`                            | PTP-GRANDMASTER-01                              | public         | Ops          | setup         | GPS                        | unresolved        | 2025-10-07   |
| {{UI_ADMIN_PASS}}                | .env.example<br>docs/PRIVACY.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Admin password                       | `^.{12,}$`                        | ********                                        | secret         | Security     | run           | none                       | unresolved        | 2025-10-07   |
| {{UI_ADMIN_USER}}                | .env.example<br>docs/PRIVACY.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Admin username                       | `^[A-Za-z0-9_.-]+$`               | admin                                           | secret         | Security     | run           | none                       | unresolved        | 2025-10-07   |
| {{UI_HOST}}                      | .env.example<br>docs/PRIVACY.md                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | TODO - document                      | .+                                | -                                               | public         | TODO         | setup         | none                       | unknown           | 2025-10-07   |
| {{UI_PORT}}                      | .env.example                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Dashboard port                       | `^[0-9]{2,5}$`                    | 8443                                            | public         | Ops          | run           | 8080                       | unresolved        | 2025-10-07   |
<!-- auto:end -->
# Privacy & Security

## Face Recognition
- Enabled by default using SCRFD + ArcFace.
- Embeddings stored encrypted (`src/privacy/embeddings_store.py`) using key `{{SEC_EXPORT_ENCRYPTION_KEY}}`.
- RBAC roles defined in `configs/frs/roles.yaml` (viewer, operator, admin).
- Enrollment API requires `FRS_ENROLLMENT_OPERATOR_NAME` and justification; audit logged to `data/audits/frs_audit.log` and HANDOFF.md.

## Access Controls
- UI served via FastAPI + Streamlit behind OAuth proxy (env placeholders `{{UI_ADMIN_USER}}`, `{{UI_ADMIN_PASS}}`).
- JWT tokens short-lived (15 min) and stored HTTP-only cookies.
- CORS locked to `{{UI_HOST}}` domain.

## Data Handling
- Non-matching faces optionally blurred (per camera config) before storage.
- Clips watermarked and hashed; export requires admin role.
- Chain-of-custody manifest generated alongside exported clip JSON.

## Network
- MQTT requires TLS when `{{MQTT_BROKER_URL}}` scheme is `mqtts://`.
- REST endpoints served on `{{EVENTS_REST_ENDPOINT}}`; enable mTLS for remote listeners.
- Drop Linux capabilities in containers; rootfs mounted read-only except volumes.

## Retention & Pruning
- Embedding TTL default 180 days; expired records shredded nightly.
- Recorder retention controlled by `{{RETENTION_DAYS}}`; optional SSD wear leveling guidelines in `docs/PERFORMANCE.md`.

## Auditing
- Every privileged action appends to HANDOFF.md via agent auto-section.
- Placeholder resolver prevents secrets leaking into repo; CI blocks if unresolved secrets in plain text.

# Aixavier Day-0 Demo Patch

Adds demo-focused pieces for UC8 (collapse), UC20 (hand gestures), UC22 (phone usage).
Heuristics now; swap to ONNX models later with same interfaces.

## Synthetic demo loop

```bash
export AIX_ARTIFACTS=./artifacts_demo
python src/apps/demo_runner.py
# Watch events in $AIX_ARTIFACTS/events.jsonl
```

## Run tests

```bash
pytest -q
```
# Setup

## 1. Base OS & JetPack
1. Flash Jetson Xavier AGX/NX with desired JetPack release (>=5.1 recommended).
2. Complete `deploy/flash-checklist.md` before network access.
3. (Optional) Lock rootfs to read-only after docker stack verified.

## 2. System Packages
```bash
sudo apt update
sudo apt install -y python3-pip python3-venv git-lfs htop nvtop
bash deploy/install_jetpack.sh
bash deploy/install_deps.sh
```

## 3. Power & Thermals
- Set power profile via `sudo nvpmodel -m 0` (45W AGX) or `-m 2` (25W NX).
- Run `sudo /usr/bin/jetson_clocks` during benchmarking; disable for steady-state if thermal margin <10 °C.
- Monitor temps with `tegrastats`; throttle guard at 85 °C.

## 4. Storage Layout
- Clips: mount SSD at `/media/ssd` and symlink to `{{STORAGE_CLIPS_PATH}}`.
- Logs: persist under `/var/log/edge-cctv` (bind-mount to docker volumes).
- Configure logrotate: copy `deploy/logrotate-edge-cctv` (create before enabling).

## 5. Time Sync
- Preferred: PTP Grandmaster at {{TIME_SYNC_SOURCE}}.
- Fallback: `chrony` with GPS PPS; ensure `timedatectl status` shows `System clock synchronized: yes`.

## 6. Repository Bootstrap

```bash
git clone {{GIT_REMOTE_URL}}
cd edge-cctv-jetson
cp .env.example .env
# Fill in required secrets and config keys in .env
make placeholders:list                  # discover unresolved placeholders
make placeholders:resolve FROM=.env     # render .env into configs/*
make bootstrap
```

**Important:** Before deploying or shipping, run `make placeholders:check` to ensure all required secrets and config keys are resolved. Only commit `.env.example` and templates—never real secrets. See [`docs/placeholders.md`](docs/placeholders.md) and the [README](../README.md) for onboarding and hygiene guidance.

## 7. Initial Run

```bash
make demo    # validates synthetic pipeline, no external streams
make perf    # capture baseline metrics (stores under artifacts/perf)
```

## 9. UI Endpoints

The FastAPI UI backend exposes endpoints for ROI editing, event browsing, and toggles:

- `POST /ui/roi` – Add a region of interest
- `GET /ui/roi` – List all ROIs
- `DELETE /ui/roi/{roi_id}` – Delete an ROI
- `POST /ui/events` – Add an event
- `GET /ui/events` – List all events
- `POST /ui/toggles` – Set a UI toggle
- `GET /ui/toggles` – List all toggles

Mount the UI router from `src/aixavier/ui/api.py` in your FastAPI app, or use the demo Compose service for local testing. See `src/aixavier/ui/README.md` for details.

## 8. Production Rollout
- Populate `configs/cameras.yaml` for each coach.
- Render systemd units using `deploy/systemd/*.service` and enable target:
  ```bash
  sudo cp deploy/systemd/*.service /etc/systemd/system/
  sudo systemctl enable edge-cctv.target
  sudo systemctl start edge-cctv.target
  ```
- Configure secrets via placeholder resolver before switching PROFILE=production.

# Aixavier Edge Analytics – US Multi-Vertical Business Model

*(Use-Case–First, Hardware-Agnostic, Wedge-Vertical Strategy)*

## 0. Executive Summary

1. **What we are** – A **use-case–driven, hardware-agnostic edge video analytics platform** that runs on multiple edge compute backends (NVIDIA GPUs, x86/NVRs, industrial PCs, and, where possible, smart cameras / ARM SoCs) and turns CCTV streams into **real-time safety, security, and operations signals**.

2. **Core IP & moat** – A **cross-vertical pattern catalog** (restricted zones, person-down, crowding, aggression, PPE, equipment misuse, smoke/fire), plus **rules/templates, KPIs, and deployment playbooks** and orchestration tooling. The value is in **patterns + rules + playbooks + deployment**, not in any particular hardware box.

3. **Where we start (wedges)** – Focused for the first 2–3 years on:

   * **Transit & Mobility** (on-vehicle and station safety/ops), and
   * **Warehousing & Logistics** (DC/3PL/e-commerce safety & throughput),
     with **Retail, Smart City, and Industrial/Critical Infrastructure** as medium-term expansion.

4. **Hardware strategy** – Architecture is **multi-backend by design**, rolled out in phases:

   * **Phase 0:** NVIDIA + common x86 edge devices (current implementation focus).
   * **Phase 1:** x86 / NVR / industrial PCs as a lightweight service.
   * **Phase 2:** selective **camera OEM / ARM SoC** integrations for smart cameras.

5. **Market** – We model a US **analytics node TAM ≈ 100–190k nodes** (midpoint ~150k). At an assumed **$3,000/node/year**, this corresponds to **~$300–570M ARR**, midpoint **≈$450M ARR**, for the **edge-side safety & operations analytics** slice of the US video analytics market.

6. **SAM (5–7 years)** – Focused on our wedges plus a small number of lighthouse deployments:

   * **~25–30k nodes**, i.e. **~$75–90M ARR** at **$3k/node/year**.

7. **5-year US scenarios (SOM)**
   At $3,000/node/year, US-only:

   * **Scenario 1 – Conservative (low case):**
     Y5 **10–12k nodes** ⇒ **$30–36M ARR** (~30–50% SAM).
   * **Scenario 2 – Base (mid case):**
     Y5 **15–18k nodes** ⇒ **$45–54M ARR** (~50–65% SAM).
   * **Scenario 3 – Aggressive (high case):**
     Y5 **25–30k nodes** ⇒ **$75–90M ARR**, approaching full SAM.

8. **Economics** – We model **$3,000/node/year** realised ARR and target **75–80% gross margins** at scale, with heavy compute at the **edge** and the **cloud** used for control-plane, logging, and fleet management.

9. **GTM** – **Wedge-driven**: high-impact pilots in transit and warehousing, packaged into **vertical playbooks**, then scaled via **system integrators and OEMs** as the “safety/ops intelligence layer” on top of existing camera+VMS stacks.

10. **Why now** – Rising **incident and liability costs**, growing **regulatory and stakeholder pressure**, **edge compute + models** now strong enough for multi-stream analytics, and increasing discomfort with **shipping raw video to the cloud**.

> **Naming note:** *“Aixavier” is a working internal codename inherited from an earlier Jetson-focused implementation. The eventual commercial brand will **not** be tied to any specific hardware vendor.*

---

## 1. Positioning & Scope (Use-Case–First, Wedge Verticals)

### 1.1 What Aixavier Is

**Aixavier Edge Analytics** is a **use-case–driven edge video analytics platform** that runs on multiple edge compute backends and turns raw CCTV streams into **actionable safety, security, and operations signals**.

**Core IP =**

* A **catalog of domain-specific use cases** grouped into **generic detection patterns** (Section 2).
* A **rules and policy engine** (zones, thresholds, schedules, workflows).
* **Orchestration & deployment tooling**:

  * Model pipelines and configs per site/vertical.
  * Fleet-wide rollout, monitoring, and over-the-air updates.
* **Integrations**:

  * Existing cameras.
  * Existing **VMS/NVR** stacks.
  * Incident, ticketing, and safety systems.

**What we are not:**

* Not a “Jetson box company” or tied to a single hardware SKU.
* Hardware (edge box, NVR, smart camera) is **replaceable plumbing**; our IP sits **above** it.

### 1.2 Wedge Verticals (First 2–3 Years)

We intentionally begin with **two wedge verticals** where:

* Safety & operations pain is visible and costly.
* Camera density is high.
* Edge constraints (bandwidth, privacy, latency) are real.

**Transit / Mobility (Wedge #1)**

* On-vehicle: railcars, buses, shuttles, people-movers.
* Fixed nodes: stations, depots, yards, terminals, park-and-rides.
* Patterns: crowding, trespass, aggression/assault, slip/fall, unsafe boarding/alighting, suspicious/unattended objects.

**Warehousing & Logistics (Wedge #2)**

* Distribution centres, 3PLs, e-commerce hubs, big-box DC networks.
* Patterns: forklift/people conflict, PPE compliance, restricted zones, dock congestion, yard intrusion, unsafe material handling.

These wedges give us:

* **Strong ROI narratives** (injury reduction, claim reduction, throughput gains).
* Sites that can justify **incremental analytics spend** per camera/node.
* Clear opportunities for **repeatable playbooks**.

### 1.3 Medium-Term Expansion Verticals

These are **explicitly medium-term**, not day-one priorities:

* **Retail & Consumer Venues** – large-format stores, malls, stadiums, arenas, casinos.
* **Smart Cities & Public Safety** – intersections, public spaces, transit hubs.
* **Critical Infrastructure & Industrial** – utilities, refineries, ports, airports’ airside, large manufacturing plants, data centres.

Strategy:

* 1–3 **lighthouse customers per vertical** to validate patterns and build reference stories.
* **Scale only after** wedge vertical playbooks and unit economics are proven.

### 1.4 Hardware Strategy – Phased, Multi-Backend

The architecture is **multi-backend by design**. Implementation rollout:

* **Phase 0 (current)** – NVIDIA-based edge devices & common x86 appliances

  * Most mature stack (CUDA, TensorRT, ONNX, Docker).
  * Current model pipelines and deployment tooling are furthest along here.

* **Phase 1** – x86 / NVR / industrial PCs

  * Ship a **lightweight edge runtime service** on standard NVRs and industrial PCs (CPU-only or CPU+GPU).
  * Leverages hardware already deployed in many DCs and transit control rooms.

* **Phase 2** – Selected camera OEMs / ARM SoCs / smart cameras

  * Integrations via camera SDKs or ONVIF extensions.
  * Host **lightweight models or metadata-emitting agents** on smart cameras.
  * Selective: only high-volume OEMs / platforms to keep focus.

**Key message:** current implementation is furthest along on **Phase 0**, but the **software architecture, APIs, and deployment model are explicitly multi-backend** and built to span all three phases.

---

## 2. Use-Case Catalog as Generic Patterns & Playbook Moat

We start from an initial set of **22 rail-flavoured use cases** and generalise them into **8 canonical detection patterns** that apply across verticals.

### 2.1 The 8 Canonical Patterns (with examples)

1. **Restricted-Zone Intrusion**

   * Person or object enters a pre-defined no-go zone.
   * **Transit example:** passenger steps off platform edge into track area; unauthorized person in tunnel.
   * **Warehouse example:** worker walks into forklift-only aisle or behind a reversing truck.

2. **Unattended / Suspicious Object**

   * Object left unattended beyond a time threshold in a sensitive context.
   * **Transit:** suitcase left on platform staircase or near ticket gates.
   * **Warehouse:** pallet or box left blocking emergency exit or fire door.

3. **Person-Down / Fall / Collapse**

   * Human appears to fall or lies motionless in concerning posture.
   * **Transit:** passenger collapses in railcar; person lying on platform.
   * **Warehouse:** worker falls off loading dock; person down in aisle.

4. **Crowding / Over-Capacity / Queues**

   * Density passes a threshold or queues exceed length/time thresholds.
   * **Transit:** platform over-crowding at peak; blocked entrances; dwell-time overruns due to slow boarding.
   * **Retail/logistics:** long checkout queues; congested dock area or staging lanes.

5. **Aggression / Violence / Fighting**

   * Rapid or repeated aggressive movements suggestive of fighting or assault.
   * **Transit:** altercation in subway car; passenger assault at station entrance.
   * **Stadium/warehouse:** fight in concourse; physical altercation in warehouse break area.

6. **Staff Compliance & Presence**

   * Expected staff position, attire, or behaviour vs defined rule.
   * **Transit:** no staff present at required door during boarding; platform unattended during dwell.
   * **Warehouse:** workers in high-risk zone without hi-vis/PPE; missing spotter near reversing truck.

7. **Equipment Misuse & Unsafe Operation**

   * Machine or vehicle used outside safe envelope.
   * **Transit:** train doors held open; door forced while moving; person riding outside safe area.
   * **Warehouse:** forklift speeding; carrying passengers; elevated load near pedestrians; machine operated with guard removed.

8. **Environmental & Smoke/Fire Anomalies**

   * Visible smoke, haze, flame, or unusual environmental patterns.
   * **Transit:** smoke in railcar; small fire in platform trash bin.
   * **Industrial/warehouse:** smoke near battery racks; haze in hazardous storage area.

### 2.2 Mapping the Original 22 Use Cases

The original **22 rail-centric use cases** map directly into these patterns, for example:

* “Person on tracks” → **Restricted-zone intrusion**.
* “Passenger collapse on platform” → **Person-down**.
* “Door obstruction / door held” → **Equipment misuse & unsafe operation**.
* “Unattended luggage” → **Unattended / suspicious object**.
* “Platform overcrowding” → **Crowding / queues**.

This mapping shows we’re not tied to **rail semantics**; we’re encoding **underlying safety/ops patterns**.

### 2.3 Why This Is More Than a List of Use Cases

The pattern catalog is **not just a list of names**. The moat is in the **operationalisation**:

For each pattern, we maintain:

* **Rules & templates per vertical**

  * Zone definitions (e.g., “red zone” near platform vs around conveyors).
  * Time thresholds, sensitivity levels, schedule templates (e.g., peak vs off-peak).
  * Combinational logic (e.g., person + elevated forklift load in the same region).

* **KPI definitions & analytics**

  * Incident rate per **10k operating hours**.
  * **Mean time to detect** (MTTD) and **mean time to respond** (MTTR).
  * False alarm rates per site per day.
  * Pre/post comparisons for deployments (e.g., reduction in undetected person-down events or investigation time).

* **Deployment templates**

  * Recommended camera placements by vertical.
  * Example **node sizing** (how many streams per node).
  * Integration best practices with existing VMS/NVR per pattern.

* **Continuous improvement loop**

  * Feedback from real incidents (true positives, false positives/negatives, near-misses).
  * Roll these into:

    * Model re-tuning or re-selection.
    * Rule and threshold adjustments.
    * Updated deployment playbooks.

> **Net effect:** The combination of **pattern catalog + rules/templates + KPIs + deployment recipes + feedback loop** becomes a **playbook IP** layer that is hard to copy by simply “adding more detectors.”

---

## 3. US Market Landscape & Node TAM

### 3.1 Macro Context – Video Surveillance & Analytics

* The **US video surveillance market** is projected to reach **≈$37B by 2030**, with an ~**11–12% CAGR**. *(Grand View Research)*
* The **global video analytics market** is estimated at **≈$10.25B in 2024**, projected to grow to **≈$49B by 2032**, with **North America ~33%** of the market. *(Fortune Business Insights)*
* Another estimate puts **North American video analytics** at **≈$4.9B in 2024**. *(Precedence Research)*

We focus on the **subset** of that market that:

* Runs **in or very close to the edge** (vehicle/station/DC/plant).
* Delivers **safety and operations** value (not just generic security or marketing analytics).

We define an **analytics node** as:

* A logical edge runtime instance handling roughly **4–16 camera streams**, depending on:

  * Resolution and frame rate.
  * Model complexity and number of patterns enabled.
  * Hardware configuration.

### 3.2 TAM by Vertical (Node Ranges & Assumptions)

#### 3.2.1 Transit / Mobility (Wedge Vertical #1)

**Facts (directional):**

* Amtrak operates **2,142 railcars and 425 locomotives**. *(Wikipedia)*
* US freight railroads invest **>$23B/year** in infrastructure and equipment. *(Association of American Railroads)*
* US transit agencies operate dozens of **metro, light rail, commuter rail, BRT, and large bus fleets**, plus **thousands of stations and depots**. *(APTA and related sources)*

**Working assumptions:**

* Only a **subset of vehicles** will be equipped with on-board analytics within our horizon.
* Not every small stop/station warrants a full node; major stations and depots do.

**Node TAM estimate:**

* **On-vehicle nodes**:

  * Targeted railcars, locomotives, large buses, and airport people-movers.
  * Many vehicles share one analytics node (per consist/fleet segment).
  * We model **~15–25k nodes** across US transit, intercity passenger rail, airport shuttles, and key bus fleets.

* **Fixed-site nodes**:

  * Major stations, depots, yards, park-and-rides, terminals.
  * Larger sites need **1–3 nodes** depending on layout and camera count.
  * We model **~5–10k nodes**.

> **Transit / Mobility node TAM:** **≈20–35k nodes**.
> **Assumptions:** partial vehicle coverage, major sites only, 1–3 nodes per significant station/yard.

#### 3.2.2 Warehousing & Logistics (Wedge Vertical #2)

**Facts (directional):**

* Some sources estimate **≈22k warehouses** in the US; broader definitions (including smaller e-commerce facilities) push this much higher, up toward **~100–150k** depending on thresholds for size and use.
* Warehouse sizes, complexity, and tech maturity vary widely.

To avoid false precision:

* We treat US warehouses/DCs as **≈40–60k sites** of varying size and tech maturity.

**Working assumptions:**

* Only **20–30%** of sites are **large and mature enough** to adopt advanced edge analytics within our 5–7 year horizon.

  * That yields **~8–18k candidate warehouses**.
* Each candidate site uses **2–4 analytics nodes**:

  * One for dock/yard, one for aisles/conveyors, possibly others for mezzanines or high-value areas.

**Node TAM estimate:**

> **Warehousing & Logistics node TAM:** **≈20–40k nodes**.
> **Assumptions:** 20–30% of all warehouses are viable; 2–4 nodes per viable site.

#### 3.2.3 Retail & Consumer Venues (Expansion, Upside)

**Facts (directional):**

* Including non-store retailers and sole proprietors, there are **≈2.8M retailers** in the US. *(Capital One Shopping)*
* In-store sales still account for **≈81.6% of US retail revenue** in 2024 (~$7.27T). *(Capital One Shopping)*

We are **not** targeting every store; only **large, complex, high-traffic** venues:

* Big-box stores.
* Malls and shopping centres.
* Stadiums, arenas, large casinos.

**Working assumptions (illustrative; not driving SAM):**

* Treat **2–3%** of retailers as “analytics-rich, large venues” ⇒ **~50–80k sites**.
* Each site uses **1–3 nodes** for entrances, concourses, high-loss zones.

> **Retail & Consumer Venues node TAM:** **≈50–80k nodes (illustrative)**.
> This is **future upside**, **not** core to the 5–7 year SAM/SOM; used as an order-of-magnitude sense-check.

#### 3.2.4 Smart Cities & Public Safety (Expansion)

Target: US cities and metros with **CCTV-rich public safety programs**.

**Working assumptions:**

* **10–20 major metros** and regional hubs are realistic candidates.
* Each may ultimately deploy **50–300 nodes**:

  * Intersections, public squares, transit hubs, tourist districts, etc.

> **Smart City node TAM:** **≈1–5k nodes**.

#### 3.2.5 Critical Infrastructure & Industrial (Expansion)

Includes:

* Utilities, refineries, power plants.
* Ports, airports’ airside, large logistics hubs.
* Large manufacturing plants and data centres.

**Working assumptions:**

* **~3–5k sites** are high-value enough to justify advanced analytics within our horizon.
* Each uses **2–6 nodes**.

> **Industrial & Critical Infrastructure node TAM:** **≈10–30k nodes**.

### 3.3 Aggregate US Node TAM

Summing the ranges:

* Transit / Mobility: **20–35k**
* Warehousing & Logistics: **20–40k**
* Retail & Consumer Venues: **50–80k** (future upside)
* Smart Cities: **1–5k**
* Industrial / Critical Infrastructure: **10–30k**

> **Total US analytics node TAM:** **≈100–190k nodes**.
> For modelling we use a midpoint of **~150k nodes**.

### 3.4 $-TAM and Sanity Check vs Existing Players

Using **$3,000/node/year** as our working pricing assumption:

> **US ARR TAM:** **≈$300–570M/year**, with a working midpoint of **≈$450M/year** for the **edge-side safety & ops analytics** segment.

**Sanity check vs existing players:**

* Cloud camera platforms (e.g. Verkada/Meraki-class vendors) and **vertical safety-AI startups** in PPE/forklift/zone safety already reach **meaningful tens to hundreds of millions** in ARR across adjacent segments.
* We use their scale as an **order-of-magnitude benchmark**, not a precise target:

  * We are focused on **edge-centric**, **multi-vertical patterns** and **integration with existing VMS/NVR stacks** rather than replacing them.

---

## 4. TAM → SAM → SOM (Wedge-Focused Logic)

### 4.1 TAM – Theoretical Ceiling

* **TAM (nodes):** all theoretically reachable nodes across our identified verticals, **≈100–190k**, midpoint **~150k**.
* **TAM (ARR):** at $3k/node/year, **≈$300–570M**, midpoint **~$450M**.

### 4.2 SAM – Serviceable Available Market (5–7 Year Horizon)

We define **SAM** as:

* What we can **reasonably** address in the US in **5–7 years**,
* Given our wedge focus, product roadmap, and channel strategy.

**SAM focus:**

* **Primary wedges:** Transit / Mobility and Warehousing & Logistics.
* **Plus:** limited lighthouse projects in Retail, Smart City, Industrial.

**Node SAM:**

* Transit / Mobility: **~10–15k nodes** (highest-value lines, depots, yards, key fleets).
* Warehousing & Logistics: **~10–15k nodes** (large DCs, e-commerce hubs, 3PL hubs, big-box DC networks).
* Lighthouse: **~1–3k nodes** across Retail, Smart City, Industrial.

> **US SAM (nodes, 5–7 yrs):** **≈25–30k nodes**.
> At **$3k/node/year**, **SAM ARR ≈ $75–90M/year**.

### 4.3 SOM – 5-Year Adoption Path (Three Scenarios)

SOM is our **actual modeled adoption** in 5 years, always ≤ SAM.

#### Scenario 1 – Conservative (Low Case)

* **Node adoption (EOY, US):**
  Y1: **500**
  Y2: **2,000**
  Y3: **6,000**
  Y4: **9,000**
  Y5: **10–12k** nodes

* **ARR at $3k/node/year:**
  Y1: **$1.5M**
  Y2: **$6.0M**
  Y3: **$18.0M**
  Y4: **$27.0M**
  Y5: **$30–36M**

* **SAM penetration (nodes):** ~30–50% by Year 5.

**Assumption sketch (Conservative):**

* Sales cycles: **18–24 months** for large agencies and national DC networks.
* **3–5 substantial pilots/year**, some constrained by budget cycles.
* Pilot → rollout conversion: **~30–40%**, with rollouts often partial estates.

#### Scenario 2 – Base (Mid Case)

* **Node adoption (EOY, US):**
  Y1: **1,200**
  Y2: **4,000**
  Y3: **9,000**
  Y4: **13,000**
  Y5: **15–18k** nodes

* **ARR at $3k/node/year:**
  Y1: **$3.6M**
  Y2: **$12.0M**
  Y3: **$27.0M**
  Y4: **$39.0M**
  Y5: **$45–54M**

* **SAM penetration (nodes):** ~50–65% by Year 5.

**Assumption sketch (Base):**

* Sales cycles: **12–18 months** for big transit deployments; shorter for private DC networks.
* Pilots: **5–10 meaningful pilots/year**, split between transit and logistics.
* Pilot → rollout conversion: **~50–60%**, where “rollout” = at least one significant corridor/fleet segment or region of DCs.

#### Scenario 3 – Aggressive (High Case)

* **Node adoption (EOY, US):**
  Y1: **2,500**
  Y2: **8,000**
  Y3: **16,000**
  Y4: **24,000**
  Y5: **25–30k** nodes

* **ARR at $3k/node/year:**
  Y1: **$7.5M**
  Y2: **$24.0M**
  Y3: **$48.0M**
  Y4: **$72.0M**
  Y5: **$75–90M**

* **SAM penetration (nodes):** approaches full SAM by Year 5.

**Assumption sketch (Aggressive):**

* Sales cycles compress to **9–15 months** due to strong references, standardised offerings, and channel leverage.
* Pilots: **10–15 pilots/year** run in parallel, in partnership with major SIs and OEMs.
* Pilot → rollout conversion: **~60–70%**, with more **multi-site / multi-corridor** rollouts per win.

---

## 5. Pricing & Unit Economics

### 5.1 Licensing Model – Node-Based, Customer-Friendly

We **model** revenue as:

> **$3,000 per node per year (ARR)**

…which corresponds to:

* Core platform.
* One vertical pattern pack.
* Some portion of premium features.
* Net of typical discounts.

**Market reality:**

* Today, analytics and cloud camera platforms are typically priced:

  * **Per camera** (e.g. $X/camera/month).
  * **Per site** (flat price per store, warehouse, station).
  * **Per device** (per NVR or edge box).

Many mature offerings land in the **hundreds of dollars per camera per year** in effective price when you unpack their SKU structure. For **4–16 cameras per node**, our **$3k/node** assumption sits in a **similar effective band**, depending on stream density and feature mix.

**Commercial packaging:**

* Internally, we track revenue **per node** for modeling, ops, and channel planning.
* Customer-facing, we expect to offer:

  * **Per-site** pricing (e.g. per warehouse, per station).
  * **Per-camera bundles** for some segments.
  * Or **hybrid** models (site minimum + camera add-ons).

Early pilots will be used to:

* Test willingness-to-pay.
* Determine which packaging feels **natural** to buyers and integrators.
* Align with existing budget categories.

### 5.2 COGS & Gross Margin

We aim for **infrastructure-style gross margins** once the platform is mature.

**Target GM:** **~75–80%**

**Working COGS per node-year:**

* **Cloud infrastructure:** control-plane, metrics, logging, configuration storage, limited video snippets for forensics/ML:

  * **$200–250 / node / year**.

* **Support & monitoring:**

  * Tier 1/2 support; NOC tooling; incident response; training materials.
  * **$300–350 / node / year**.

* **Tooling & enablement:**

  * Internal dev tools, CI/CD, channel enablement content, partner sandboxes (amortised).
  * **$100–150 / node / year**.

> **Total COGS:** **$600–750 / node / year**.
> At $3,000/node, this implies **gross margin ~75–80%**.

This assumes:

* Most heavy compute runs on **customer/OEM hardware** (edge nodes, NVRs, smart cameras), not our cloud.
* Cloud usage is disciplined and monitored.
* Support is progressively **standardised and automated** (playbooks, dashboards, self-service).

---

## 6. 5-Year US Revenue Scenarios (Node & ARR Only)

Using the node paths in Section 4 and **$3k/node/year**:

### 6.1 Scenario 1 – Conservative (Low Case)

* Nodes: **0.5k → 2k → 6k → 9k → 10–12k**
* ARR: **$1.5M → $6.0M → $18.0M → $27.0M → $30–36M**

This is the “slow but real adoption” path:

* Strong references from a handful of flagship customers.
* Real revenue, but slower SAM penetration; room to grow beyond Year 5.

### 6.2 Scenario 2 – Base (Mid Case)

* Nodes: **1.2k → 4k → 9k → 13k → 15–18k**
* ARR: **$3.6M → $12.0M → $27.0M → $39.0M → $45–54M**

This is the case we consider **most representative of a successful but not insane outcome** in US wedges alone, assuming:

* Healthy but not hyper-growth adoption in transit and logistics.
* 50–60% pilot → rollout conversion.
* GTM capacity ramped sensibly, with partners coming online.

### 6.3 Scenario 3 – Aggressive (High Case)

* Nodes: **2.5k → 8k → 16k → 24k → 25–30k**
* ARR: **$7.5M → $24.0M → $48.0M → $72.0M → $75–90M**

This corresponds to:

* Approaching **full SAM penetration** in wedge verticals plus some lighthouse expansions.
* Very strong references.
* Significant leverage via **SIs and OEMs**.

### 6.4 Margin Profile Across Scenarios

Across all three scenarios:

* We target **GM ~75–80%** as we scale, built on:

  * Node ARR **$3,000**.
  * COGS **$600–750/node/year**.
* Gross profit per node: **$2,250–2,400**.

Our model suggests:

* In **Conservative**, profitability comes later (post-Year 5) unless we keep OPEX extremely tight.
* In **Base**, we can approach **break-even around Year 3** and become solidly profitable in Years 4–5 with healthy EBITDA margins.
* In **Aggressive**, we have headroom to invest more in GTM while still attaining strong overall margins.

(Full FTE/EBITDA breakdown in Appendix E.)

---

## 7. GTM & Vertical Execution

### 7.1 Wedge-Driven Motion (Transit & Logistics)

**Years 1–2 – Pilot-led wedge focus**

* **Transit/Mobility pilots (3–5):**

  * One major metro or commuter agency (platform + vehicle analytics).
  * One bus/BRT system or large city transit operation.
  * One airport rail/shuttle context.

* **Warehousing/Logistics pilots (3–5):**

  * One major 3PL.
  * One e-commerce pure-play.
  * One big-box retailer’s DC network.

Each pilot:

* Deploys **multiple patterns** (at least 3–4) to show breadth:
  restricted-zone intrusion, person-down, crowding/queues, PPE/compliance, equipment misuse.
* Has explicit **before/after metrics**:

  * Investigation time reduction.
  * Additional incidents detected.
  * Operator workload.
  * Any measurable reduction in claims / near-misses (where possible over period).

**Years 3–5 – From pilots to standard playbooks**

* Convert successful pilots into **corridor-level or multi-site rollouts**:

  * Transit: entire corridor/line or fleet segment.
  * Logistics: all DCs in a region, or a set of nationally important DCs.

* Productise into named playbooks, e.g.:

  * **“Rail Safety & Dwell Optimisation Pack”**
    → patterns: restricted-zone, crowding, person-down, aggression.
  * **“Warehouse Safety & Throughput Pack”**
    → patterns: forklift/people conflict, PPE, dock congestion, person-down.

* Grow channel:

  * Train **system integrators** (CCTV, VMS, rail signalling, warehouse automation) to sell and deploy these playbooks.
  * Explore **OEM bundles**: pre-loaded analytics on edge boxes or NVRs.

### 7.2 Long-Term Positioning in the Ecosystem

Longer-term goal:

* Become the **default “safety & ops intelligence layer”** that:

  * Sits **next to** existing VMS/NVR stacks.
  * Consumes camera streams.
  * Emits events/metadata into the customer’s incident & safety workflows.

We do **not** want to replace all VMS; we want:

* SIs and hardware vendors to view us as a **revenue-accretive module**.
* Customers to deploy us **gradually across estates** on their own timelines.

---

## 8. Regulation, Risk & “Why Now”

### 8.1 Safety & Liability Drivers – Warehousing & Logistics

* Warehouses and DCs are among the **highest-risk workplaces**:

  * Forklift and vehicle strikes.
  * Falls from docks and mezzanines.
  * Struck-by or caught-between incidents.

* **Slip/trip/fall and material handling** injuries are major cost drivers for:

  * Workers’ comp claims.
  * OSHA recordables.
  * Lost-time incidents and absenteeism.

* Regulators and insurers increasingly expect:

  * Proactive **hazard identification and mitigation**.
  * Documented evidence that companies are using **“reasonably available technology”** to reduce risk.

### 8.2 Safety & Liability Drivers – Transit / Mobility

* Transit agencies face:

  * Assaults and harassment in vehicles and stations.
  * Vandalism, theft, fare evasion.
  * Suicides and trespass incidents on tracks.
  * Platform crowding and crush risks.

* High-profile incidents lead to:

  * Media scrutiny and political pressure.
  * Regulatory investigations.
  * Civil litigation and settlements.

The question from regulators, boards, and the public increasingly is:

> “What systems did you have in place to **detect and prevent** this?”

### 8.3 Why Edge vs Pure Cloud

**Constraints on “upload everything” approaches:**

* Bandwidth:

  * Vehicles in tunnels or remote depots.
  * Large DCs pushing hundreds of cameras’ worth of video.

* Privacy and policy:

  * Statutes and internal policies limiting off-site/supervisory access to raw video.
  * Unions and worker councils sensitive to “constant remote monitoring”.

**Edge analytics advantages:**

* Raw video remains **on-site**; only events/metadata or short clips are exported.
* Latency is low; reactions to person-down or restricted-zone intrusions can be **seconds**, not minutes.
* Cloud compute costs are controlled; scaling is primarily about **node hardware**.

### 8.4 “Why Now?” in One Sentence

> **Incident and liability pressures are rising, edge compute and models are finally good enough, and organisations are looking for a practical middle ground between dumb cameras and “ship everything to the cloud”.**

---

## 9. Assumptions & Risks (Hypothesis Framing)

This report is a **structured, quantified hypothesis** about a large opportunity—not a forecast locked in stone.

### 9.1 Key Modeling Assumptions

* **Market sizing**:

  * Node TAM **100–190k** (midpoint 150k).
  * SAM **~25–30k nodes** in 5–7 years in US wedges + lighthouses.

* **Pricing**:

  * Effective **$3,000/node/year** realised ARR aligns with ballpark per-camera ranges in adjacent products.

* **Economics**:

  * COGS **$600–750/node/year**; GM **~75–80%** achievable with edge-first compute and disciplined support.

* **Adoption curves**:

  * Conservative/Base/Aggressive paths described in Section 4 are **ambitious but feasible** if:

    * Pilots convert at the suggested rates.
    * We execute GTM and partnerships effectively.

### 9.2 Material Risks

* **Sales cycle risk**:

  * Public transit has long budget cycles and complex procurement.
  * Mitigation: standardised pilot offers, strong SI partners, playbooks that fit into existing RFP structures.

* **Competitive response**:

  * VMS vendors and cloud camera platforms can incrementally add analytics features.
  * Our advantage needs to be:

    * **Edge-centric** rather than cloud-only.
    * **Pattern + playbook IP** rather than generic detectors.
    * Strong integration story with multiple hardware backends.

* **Support and COGS creep**:

  * Heavy bespoke deployments or “special snowflake” integrations could drive up COGS.
  * Mitigation: strict productisation; standard APIs; integration tiers.

* **Regulatory and privacy pushback**:

  * Particularly from unions and worker councils.
  * Mitigation: edge-first design, clear privacy controls, policy templates, and audit logs.

### 9.3 How to Read the Numbers

* Think of all numeric values as **“what we believe is realistic given what we know now”**, not guarantees.
* The key investor-level takeaway is:

> We believe there is a **$75–90M ARR SAM** in our wedges, and we have a **structured, testable plan** to get to **$30–60M ARR** in 5 years in the US if things go reasonably well.

---

## 10. Customer Discovery & Voice of Customer (Plan)

*(Full detail in Appendix F; here is the summary.)*

### 10.1 Interview Plan (15–25 Conversations)

* **Targets by vertical:**

  * **Warehousing & Logistics:**

    * Safety/EHS managers.
    * DC operations managers.
    * Security managers.
    * IT/OT leads.

  * **Transit / Mobility:**

    * Transit safety officers / chiefs.
    * Security / transit police.
    * Operations control centre managers.
    * CIO/IT architects.

  * **Exploratory (expansion):**

    * Retail loss prevention / asset protection.
    * City CCTV program leads.
    * HSE managers in industrial/ports.

* **Volume and timing:**

  * **15–25 interviews** over **3–4 months**, with emphasis on wedges.

### 10.2 Themes & Questions

Key discovery themes:

* Current **incident workflows** (from detection to investigation to remediation).
* Pain points with **video today** (time to find footage, missed incidents).
* Experience with **existing analytics** (basic motion detection, OEM analytics, any AI trials).
* **Budget ownership & procurement paths** (who signs cheques, how decisions are made).
* **Constraints and fears** (IT security, unions, privacy, false positives).
* Perceived **value and ROI** (what would make the solution an obvious “yes”).

### 10.3 Outputs & How They Feed Back

From the first 15–25 interviews, we expect to produce:

* **6–10 anonymised verbatim quotes** capturing key attitudes and pain.
* **1–2 pages of pattern summaries**:

  * Top recurring pains.
  * What they currently do (workarounds).
  * Common objections to AI analytics.
  * Early signals on willingness to pay and preferred pricing models.

This will refine:

* Our **pricing packaging** (per site vs per camera vs per node).
* Our **positioning** (which patterns resonate as “must-have”).
* Our **GTM playbooks** (which roles to target first, how to frame pilots).

---

# Appendices

---

## Appendix A – Competitive Landscape & Alternatives

### A.1 Categories of Alternatives

1. **Traditional VMS + Camera OEM Analytics**

   * Examples: Genetec, Milestone, Avigilon; camera OEM analytics from Axis, Bosch, Hanwha.
   * Strengths:

     * Mature recording/archival & operator workflows.
     * Basic analytics (motion detection, line crossing, simple intrusion, counting).
   * Limitations:

     * Analytics often bolt-on; noisy; configured once, then ignored.
     * Not deeply tied into safety/ops workflows.

2. **Cloud-First Camera/AI Platforms**

   * Examples: Verkada, Meraki, Rhombus, others in cloud camera space.
   * Strengths:

     * Very strong on **ease of deployment**, remote access, updates.
     * Centralised management across many sites.
   * Limitations:

     * Often tied to **proprietary hardware**.
     * Analytics mostly generic (people/vehicle detection, basic counting).
     * Bandwidth and privacy concerns in sensitive environments.

3. **Vertical Safety-AI Startups**

   * Examples:

     * Forklift and PPE safety platforms.
     * Zone-safety analytics for industrial plants.
   * Strengths:

     * Deep focus on one category (forklift-people conflict, PPE).
     * Strong domain knowledge; targeted ROI stories.
   * Limitations:

     * Narrow scope; not a broad platform across verticals.
     * Hardware-locked or bespoke appliances in many cases.

4. **Status Quo / “Do Nothing”**

   * Cameras + NVR + manual review.
   * Occasional motion detection or line-crossing rules that operators largely ignore.

### A.2 Conceptual 2×2

Axes:

* **X-axis:** Generic security / “all-purpose surveillance” ⟶ Deep safety & operations.

* **Y-axis:** Cloud-centric ⟶ Edge-native.

* Traditional VMS/OEM: **generic; more on-prem**, sits **middle-left**.

* Cloud camera platforms: **cloud-centric, generic**; sits **top-left**.

* Vertical Safety-AI startups: **deep but narrow**, often cloud or specific edge; sits **right side** (top/middle).

* **Aixavier:** **edge-native**, **safety/ops-focused**, **pattern/playbook-driven**, sits **bottom-right**.

### A.3 Comparison Table

| Dimension               | Typical VMS                                       | Cloud Camera Platform                           | Vertical Safety-AI Startup                         | **Our Platform (Aixavier)**                                                                                        |
| ----------------------- | ------------------------------------------------- | ----------------------------------------------- | -------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------ |
| **Deployment model**    | On-prem server, sometimes hybrid                  | Cloud-first; cameras “phone home”               | Mixed; often custom box or cloud                   | Edge-native runtime + cloud/on-prem control-plane                                                                  |
| **Hardware stance**     | Vendor-agnostic cameras; server HW required       | Often tied to proprietary cameras               | Often tied to specific box/HW                      | Hardware-agnostic runtime (NVIDIA/x86/IPC); optional OEM bundles                                                   |
| **Analytics scope**     | Broad but shallow (motion, line, basic intrusion) | Broad but shallow (people, vehicles, counting)  | Narrow but deep in one domain                      | Broad **pattern catalog**, deep in safety/ops for chosen wedges                                                    |
| **Use-case modelling**  | Individual “features” (tripwire, count)           | Basic detectors and alerts                      | Concrete single-purpose scenarios (PPE, forklifts) | **Pattern-based playbooks** (restricted zones, person-down, crowding, aggression, etc.), parameterised by vertical |
| **Customisability**     | Rules/layouts; deeper changes = PS projects       | Configurable in cloud UI; limited model control | Limited beyond core scenarios                      | Configurable patterns and rules; vertical templates; PS used to extend catalog                                     |
| **Integration style**   | SDKs, plugins for VMS, on-prem APIs               | Cloud/webhooks; some on-prem agents             | Often bespoke integration                          | Designed to sit **next to existing VMS/NVR**, with standard event/metadata APIs                                    |
| **Cloud vs Edge**       | Mostly on-prem; some hybrid                       | Cloud-heavy; video often leaves site            | Varies by vendor                                   | Edge-heavy inference; cloud for fleet management & metrics                                                         |
| **Typical positioning** | Core “video plumbing”                             | All-in-one cloud camera stack                   | Single-domain safety add-on                        | Cross-vertical **safety/ops intelligence layer** on existing camera+VMS                                            |

**Explicit acknowledgement:**
Many incumbents already have **zone intrusion, counting, and dwell-time analytics** as checkboxes. Our differentiation is **not** “we detect objects too”, but:

* **Edge-native design** tailored to bandwidth/privacy constraints.
* A **pattern + playbook catalog** focused on safety & ops outcomes.
* Deliberate **multi-backend** integration strategy with existing camera+VMS ecosystems.

---

## Appendix B – Existing Edge & VMS Ecosystem (Transit & Warehousing)

### B.1 Transit / Mobility Stack

Common components:

* **Cameras:** IP (Axis, Bosch, Hanwha, Panasonic, etc.), vehicle-rated models, some analog on older systems.
* **Vehicle recorders / mobile NVRs:** dedicated boxes with SSD/HDD, often vendor-specific.
* **Station VMS:** Genetec, Milestone, Avigilon, OnSSI, etc., deployed per station or centrally.
* **Backhaul:** wired networks in stations; Wi-Fi/cellular backhaul for vehicles.

Deployment options for Aixavier:

1. **Agent/container on existing edge servers/NVRs**

   * Where NVRs or station servers support containers or third-party services.
   * Pros: no extra hardware, simpler procurement.
   * Cons: heterogeneous platforms; varying performance.

2. **Separate edge appliance**

   * Dedicated box in rack rooms or vehicle cabinets.
   * Taps RTSP/ONVIF streams from cameras/NVRs.
   * Sends events/metadata back to VMS and incident systems.

**Integration priorities:**

* Target VMS vendors with open APIs/event injection.
* Mobile NVR vendors that:

  * Expose streams.
  * Allow light-weight apps or send metadata.

### B.2 Warehousing & Logistics Stack

Components:

* **Cameras:** IP cameras from common OEMs; legacy analog via encoders.
* **NVRs:** off-the-shelf NVRs or VMS-managed storage servers.
* **VMS:** mid-market to enterprise-grade, depending on operator size.
* **Network:** wired inside facility; some separate OT or security subnets.

Deployment options:

1. **Service on existing x86/NVR/industrial PC**

   * When the environment supports Windows/Linux services or containers.
   * Minimises new hardware; good for enterprises standardised on a vendor.

2. **Dedicated edge appliance**

   * In the network rack, ingesting streams from cameras/NVRs.
   * Publishes events into VMS/SOC dashboards and safety tools.

**Logical partnerships:**

* VMS vendors strong in **logistics/industrial** verticals.
* NVR/industrial PC vendors already selling into DCs.
* Automation integrators (WMS, robotics) who want to bundle safety analytics.

---

## Appendix C – Buying Journey & GTM Details

### C.1 Warehousing & Logistics – Buying Journey

* **Champion:**

  * Safety/EHS manager, or
  * DC operations manager who owns throughput and injuries.

* **Economic buyer:**

  * VP Operations, Head of Supply Chain.
  * Sometimes CFO if claims are large and visible.

* **Gatekeepers:**

  * IT (network, security, architecture).
  * Legal/Risk (privacy, policies).
  * EHS if not champion.

* **Sales path:**

  * Early: **direct + a few trusted integrators**, pilot-heavy.
  * Later: via **existing integrators** who already supply CCTV/WMS/automation.

### C.2 Transit / Mobility – Buying Journey

* **Champion:**

  * Chief safety officer or equivalent.
  * Security lead / transit police.
  * Operations control centre leadership.

* **Economic buyer:**

  * COO / Director of Operations.
  * Sometimes CIO/CTO if embedded into broader modernisation.

* **Gatekeepers:**

  * IT (cybersecurity, integration).
  * Legal/compliance.
  * Unions / worker councils (privacy & real-time monitoring concerns).

* **Sales path:**

  * Early: **direct engagement + pilots**, usually with a specialised transit SI.
  * Later: part of bigger **SI/OEM contracts** (rolling stock upgrades, signalling, control room projects).

### C.3 GTM Evolution

* **Years 1–2:** founder-led, direct sales; design partner style pilots.
* **Years 3–5:** shift towards **SI and OEM-driven distribution**; playbooks packaged for resale.
* **Long-term:** analytics becomes a **standard line item/module** in transit and DC solution stacks.

---

## Appendix D – Canonical Pattern Table (Detailed)

| Pattern                              | Short Description                    | Transit / Mobility Example                                | Warehousing / Logistics Example                                                  |
| ------------------------------------ | ------------------------------------ | --------------------------------------------------------- | -------------------------------------------------------------------------------- |
| Restricted-zone intrusion            | Entry into defined no-go zone        | Passenger steps beyond platform edge; trespass in tunnel  | Worker enters forklift-only aisle; person in exclusion zone near heavy machinery |
| Unattended / suspicious object       | Object left unmoved beyond threshold | Luggage left near stairs/gate for >X minutes              | Pallet left blocking fire exit; object in emergency pathway                      |
| Person-down / fall / collapse        | Human falls or lies motionless       | Passenger collapses in railcar or on platform             | Worker falls off dock; person lying on warehouse floor                           |
| Crowding / over-capacity / queues    | Density or queues exceed limit       | Platform overcrowded; entrance blocked; dwell extended    | Long checkout/staging queues; congested dock or lane                             |
| Aggression / violence / fighting     | Patterns suggesting fight/assault    | Two people fighting inside train or at station            | Physical altercation in break area or yard                                       |
| Staff compliance & presence          | Staff/PPE vs expected rules          | No staff at assigned door during dwell                    | Worker in high-risk area without PPE; no spotter where required                  |
| Equipment misuse / unsafe operation  | Machine outside safe envelope        | Doors forced while train moving; riding outside safe area | Forklift speeding; elevated load near pedestrians; riding on forks               |
| Environmental & smoke/fire anomalies | Smoke, haze, flame anomalies         | Smoke in car; bin fire on platform                        | Smoke near battery racks; haze in hazardous storage zone                         |

**Usage:**

* Each pattern is implemented once, then **parameterised by vertical** (zones, thresholds, semantics).
* New verticals map to the same patterns; we **don’t** reinvent new detectors each time.

---

## Appendix E – Financial Appendix (FTE & EBITDA Sketch)

### E.1 FTE Ramp (Illustrative, Base Case)

* **Y1:** ~20 FTE

  * Founders, core engineering (models + runtime), 1 PM, 1–2 sales, 1 ops/support.
* **Y2:** ~35 FTE

  * More engineers (deployment + integrations), 2–3 GTM hires, 1–2 support/CS.
* **Y3:** ~55 FTE

  * Dedicated vertical PMs, more AE/SE headcount, customer success, support.
* **Y4:** ~75 FTE

  * Regional GTM coverage, partner managers, reliability and SRE.
* **Y5:** ~95 FTE

  * Mature GTM and eng teams; expanded CS and partner enablement.

**Blended fully-loaded cost:**
We use **$180k/FTE/year** as a modelling assumption (US-weighted, some global hiring).

### E.2 EBITDA Trajectory (Qualitative)

Given:

* Node/ARR scenarios (Section 6).
* GM target **75–80%**.
* FTE ramp above, plus **15–20% of revenue** as other OPEX (marketing, travel, G&A).

We get:

* **Conservative (low case):**

  * Y1–Y2: meaningfully negative EBITDA while building product and references.
  * Y3: narrower losses as revenue increases.
  * Y4–Y5: approaching break-even to modest profitability.

* **Base (mid case):**

  * Y1: negative, heavy investment.
  * Y2: losses shrink as ARR grows.
  * **Y3:** near break-even.
  * **Y4–Y5:** opportunity for **20–30%+ EBITDA margin** if growth and efficiency are balanced.

* **Aggressive (high case):**

  * We may **reinvest** aggressively in GTM and R&D; profitability depends on pace of hiring.
  * Even with investment, the underlying economics support attractive margins at scale.

(Investors can reconstruct exact numbers from nodes × pricing, COGS assumption, FTE ramp, and OPEX %.)

---

## Appendix F – Customer Discovery & Research Roadmap (Detailed)

### F.1 Customer Interviews – Detailed Plan

**Roles per vertical:**

* **Warehousing & Logistics:**

  * Safety/EHS.
  * DC Ops / Site Manager.
  * Security.
  * IT/OT.

* **Transit / Mobility:**

  * Safety officer.
  * Security / transit police.
  * OCC manager.
  * CIO/IT architect.

* **Exploratory (expansion):**

  * Retail LP/AP.
  * City CCTV programme managers.
  * Industrial HSE.

**Volumes:**

* 8–12 interviews in warehousing & logistics.
* 6–8 in transit/mobility.
* 3–5 exploratory.

### F.2 Interview Guide – Sample Questions

**Incident workflow**

* “Tell me about the last serious safety incident. How did you find out, and how did video get used?”
* “How long did it take to locate and review the relevant footage?”

**Pain with video**

* “Where does video fail you today?”
* “Do you feel like you’re missing incidents?”

**Analytics experience**

* “What analytics do you have now (if any)? Motion, lines, AI? Do you trust them?”
* “Have you trialed advanced analytics before? What happened?”

**Budgets & procurement**

* “Who would sign a cheque for a system like this?”
* “Which budget does it come from (Safety, Security, Ops, IT, CapEx/OpEx)?”
* “How do you normally buy tech like this? RFP, pilots, multi-year contracts?”

**Constraints/fears**

* “What would make you nervous about ‘AI watching cameras’?”
* “If a vendor promised ‘zero false positives’, what would you think?”

**Value & ROI**

* “If this worked extremely well, what would it change in 12–24 months?”
* “What evidence would you need to see to say: this is obviously worth paying for?”

### F.3 Expected Outputs – Example Quotes & Patterns

Once we’ve run a first tranche, we expect to summarise:

**Example anonymised quotes:**

* > “We have 900+ cameras and maybe three pairs of eyes watching them. Most of the time we’re blind until someone gets hurt.” – Ops Manager, large DC
* > “After an incident, we spend days scrubbing video. The worst part is when we never find the one moment that matters.” – Safety Lead, commuter rail
* > “We’ve tried AI analytics, but false positives killed it. Once my team stops trusting alerts, the system is dead.” – Security Manager, warehouse campus
* > “Our IT folks don’t want any live video streaming to the cloud. If it doesn’t run on-site, it’s basically a non-starter.” – IT Architect, transit agency

**Patterns:**

* Investigation time is **too long**; staff time is expensive.
* Many incidents are missed **entirely** because no one is watching.
* Distrust of generic “AI analytics” due to false positives.
* Strong concern about **privacy, bandwidth, security** and cloud.

### F.4 Research Roadmap (3–12 Months)

**Data to collect:**

* **Customer interviews** (above).

* **Pilot metrics**:

  * Per pattern: precision/recall, FP/FN rates.
  * Investigation time before/after.
  * Any measured change in incident detection or near-miss capture.

* **Integration friction**:

  * Document how hard each VMS/NVR stack is to integrate with.
  * Build qualitative “integration difficulty scores”.

* **Pricing experiments**:

  * Compare response to per-node vs per-site vs per-camera quotes.
  * Observe discount sensitivity and preferred term lengths.

* **Cost actuals vs model**:

  * Track real **cloud and support costs** per node in pilots.
  * Compare to **$600–750/node/year** assumption.

This roadmap ensures the model in this memo becomes **tighter and more evidence-backed** over the next **3–12 months**.# Troubleshooting

## RTSP / ONVIF
- Verify stream reachable: `gst-launch-1.0 rtspsrc location=${CAMERA_RTSP_URL_01} ! decodebin ! fakesink`
- If ONVIF discovery fails, confirm credentials `{{CAMERA_ONVIF_USER}}` / `{{CAMERA_ONVIF_PASS}}` and NTP sync.
- Use `tests/test_rtsp_connect.sh` for quick health probe.

## Black Frames / Decoder Issues
- Ensure Jetson multimedia packages installed. Run `dpkg -l | grep nvidia-l4t-gstreamer`.
- Enable `drop-on-late=0` in `ingest_gst/pipeline.conf` to avoid frame drops.

## Thermal Throttling
- Watch `tegrastats`; if GPU throttle, clean heatsink and reduce action detector interval.
- Consider dynamic tiler resolution (set `downscale: 0.5` in `configs/cameras.yaml`).

## MQTT Delivery
- Confirm broker accessible: `mosquitto_sub -h {{MQTT_BROKER_HOST}} -t diagnostics/#`.
- Use `events/logs/*.json` to inspect failed deliveries.

## Placeholder Linter Failures
- Run `make placeholders:check` for detailed output.
- Update `docs/placeholders.md` with new placeholders before re-running CI.

## Agent PR Conflicts
- Agent operates on branch `agent/update-YYYYMMDD`. If manual edits conflict, mark file sections inside `<!-- manual -->` blocks.

